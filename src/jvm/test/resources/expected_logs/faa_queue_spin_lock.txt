= The execution has hung, see the thread dump =
| ----------------------------------- |
|  Thread 1  | Thread 2  |  Thread 3  |
| ----------------------------------- |
| enqueue(1) |           |            |
| enqueue(1) |           |            |
| ----------------------------------- |
| enqueue(1) | dequeue() | dequeue()  |
| dequeue()  | dequeue() | enqueue(1) |
| ----------------------------------- |
| enqueue(1) |           |            |
| dequeue()  |           |            |
| ----------------------------------- |


The following interleaving leads to the error:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                    Thread 1                                                    | Thread 2  |                                                    Thread 3                                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| enqueue(1)                                                                                                     |           |                                                                                                                |
| enqueue(1)                                                                                                     |           |                                                                                                                |
|                                                                                                                | dequeue() |                                                                                                                |
|                                                                                                                | dequeue() |                                                                                                                |
|                                                                                                                |           | dequeue()                                                                                                      |
|                                                                                                                |           | enqueue(1)                                                                                                     |
|                                                                                                                |           |   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                    |
|                                                                                                                |           |     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                          |
|                                                                                                                |           |     /* The following events repeat infinitely: */                                                              |
|                                                                                                                |           | ┌╶> tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312) |
|                                                                                                                |           | |   compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                |
|                                                                                                                |           | |   randomCellIndex(): 2 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:313)                          |
|                                                                                                                |           | └╶╶╶/* The next call would cause infinite spin-cycle, switch to avoid it */                                    |
|                                                                                                                |           |     switch (reason: active lock detected)                                                                      |
| enqueue(1)                                                                                                     |           |                                                                                                                |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                    |           |                                                                                                                |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                          |           |                                                                                                                |
|     /* The following events repeat infinitely: */                                                              |           |                                                                                                                |
| ┌╶> tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312) |           |                                                                                                                |
| |   compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                |           |                                                                                                                |
| |   randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:313)                          |           |                                                                                                                |
| └╶╶╶/* The next call would cause infinite spin-cycle, switch to avoid it */                                    |           |                                                                                                                |
|     switch (reason: active lock detected)                                                                      |           |                                                                                                                |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock

Detailed trace:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                         Thread 1                                                         |                                                         Thread 2                                                         |                                                         Thread 3                                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| enqueue(1)                                                                                                               |                                                                                                                          |                                                                                                                          |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                              |                                                                                                                          |                                                                                                                          |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                                    |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |                                                                                                                          |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |                                                                                                                          |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)           |                                                                                                                          |                                                                                                                          |
|     compareAndSet(1,null,1): true at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                           |                                                                                                                          |                                                                                                                          |
|     tryLock(): true at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:316)                                         |                                                                                                                          |                                                                                                                          |
|       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(SpinlockEventsCutTests.kt:306)                 |                                                                                                                          |                                                                                                                          |
|     help() at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:323)                                                  |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(0): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(1): 1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                                |                                                                                                                          |                                                                                                                          |
|       add(1): true at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:361)                                             |                                                                                                                          |                                                                                                                          |
|         addLast(1) at ArrayDeque.add(ArrayDeque.kt:179)                                                                  |                                                                                                                          |                                                                                                                          |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:135)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           ensureCapacity(1) at ArrayDeque.addLast(ArrayDeque.kt:135)                                                     |                                                                                                                          |                                                                                                                          |
|             elementData.READ: Object[]@1 at ArrayDeque.ensureCapacity(ArrayDeque.kt:60)                                  |                                                                                                                          |                                                                                                                          |
|             elementData.READ: Object[]@1 at ArrayDeque.ensureCapacity(ArrayDeque.kt:61)                                  |                                                                                                                          |                                                                                                                          |
|             elementData.WRITE(Object[]@2) at ArrayDeque.ensureCapacity(ArrayDeque.kt:62)                                 |                                                                                                                          |                                                                                                                          |
|           elementData.READ: Object[]@2 at ArrayDeque.addLast(ArrayDeque.kt:137)                                          |                                                                                                                          |                                                                                                                          |
|           head.READ: 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                          |                                                                                                                          |                                                                                                                          |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           positiveMod(0): 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                     |                                                                                                                          |                                                                                                                          |
|             elementData.READ: Object[]@2 at ArrayDeque.positiveMod(ArrayDeque.kt:87)                                     |                                                                                                                          |                                                                                                                          |
|           WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:137)                                                              |                                                                                                                          |                                                                                                                          |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:138)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           size.WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:138)                                                         |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:362)            |                                                                                                                          |                                                                                                                          |
|       set(1,Result@1) at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:362)                                          |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(2): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |                                                                                                                          |
|     unlock() at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:324)                                                |                                                                                                                          |                                                                                                                          |
|       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(SpinlockEventsCutTests.kt:307)                  |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:325)           |                                                                                                                          |                                                                                                                          |
|     get(1): Result@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:325)                                        |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:326)           |                                                                                                                          |                                                                                                                          |
|     set(1,null) at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:326)                                             |                                                                                                                          |                                                                                                                          |
| enqueue(1)                                                                                                               |                                                                                                                          |                                                                                                                          |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                              |                                                                                                                          |                                                                                                                          |
|     randomCellIndex(): 0 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                                    |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |                                                                                                                          |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |                                                                                                                          |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)           |                                                                                                                          |                                                                                                                          |
|     compareAndSet(0,null,1): true at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                           |                                                                                                                          |                                                                                                                          |
|     tryLock(): true at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:316)                                         |                                                                                                                          |                                                                                                                          |
|       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(SpinlockEventsCutTests.kt:306)                 |                                                                                                                          |                                                                                                                          |
|     help() at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:323)                                                  |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(0): 1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                                |                                                                                                                          |                                                                                                                          |
|       add(1): true at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:361)                                             |                                                                                                                          |                                                                                                                          |
|         addLast(1) at ArrayDeque.add(ArrayDeque.kt:179)                                                                  |                                                                                                                          |                                                                                                                          |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:135)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           ensureCapacity(2) at ArrayDeque.addLast(ArrayDeque.kt:135)                                                     |                                                                                                                          |                                                                                                                          |
|             elementData.READ: Object[]@2 at ArrayDeque.ensureCapacity(ArrayDeque.kt:60)                                  |                                                                                                                          |                                                                                                                          |
|           elementData.READ: Object[]@2 at ArrayDeque.addLast(ArrayDeque.kt:137)                                          |                                                                                                                          |                                                                                                                          |
|           head.READ: 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                          |                                                                                                                          |                                                                                                                          |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           positiveMod(1): 1 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                     |                                                                                                                          |                                                                                                                          |
|             elementData.READ: Object[]@2 at ArrayDeque.positiveMod(ArrayDeque.kt:87)                                     |                                                                                                                          |                                                                                                                          |
|           WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:137)                                                              |                                                                                                                          |                                                                                                                          |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:138)                                                             |                                                                                                                          |                                                                                                                          |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |                                                                                                                          |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |                                                                                                                          |
|           size.WRITE(2) at ArrayDeque.addLast(ArrayDeque.kt:138)                                                         |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:362)            |                                                                                                                          |                                                                                                                          |
|       set(0,Result@2) at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:362)                                          |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(1): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |                                                                                                                          |
|       get(2): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |                                                                                                                          |
|     unlock() at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:324)                                                |                                                                                                                          |                                                                                                                          |
|       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(SpinlockEventsCutTests.kt:307)                  |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:325)           |                                                                                                                          |                                                                                                                          |
|     get(0): Result@2 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:325)                                        |                                                                                                                          |                                                                                                                          |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:326)           |                                                                                                                          |                                                                                                                          |
|     set(0,null) at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:326)                                             |                                                                                                                          |                                                                                                                          |
|                                                                                                                          | dequeue()                                                                                                                |                                                                                                                          |
|                                                                                                                          |   dequeue(): 1 at FaaQueueSpinLockTest.dequeue(SpinlockEventsCutTests.kt:264)                                            |                                                                                                                          |
|                                                                                                                          |     randomCellIndex(): 2 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:331)                                    |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |
|                                                                                                                          |       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |
|                                                                                                                          |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |
|                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)           |                                                                                                                          |
|                                                                                                                          |     compareAndSet(2,null,Dequeue@1): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)                   |                                                                                                                          |
|                                                                                                                          |     tryLock(): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:337)                                         |                                                                                                                          |
|                                                                                                                          |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(SpinlockEventsCutTests.kt:306)                 |                                                                                                                          |
|                                                                                                                          |     help() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:344)                                                  |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(0): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(1): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(2): Dequeue@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                        |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)            |                                                                                                                          |
|                                                                                                                          |       removeFirstOrNull(): 1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                   |                                                                                                                          |
|                                                                                                                          |         isEmpty(): false at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                              |                                                                                                                          |
|                                                                                                                          |           size(): 2 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                              |                                                                                                                          |
|                                                                                                                          |             getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |
|                                                                                                                          |               size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |
|                                                                                                                          |         removeFirst(): 1 at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                              |                                                                                                                          |
|                                                                                                                          |           isEmpty(): false at ArrayDeque.removeFirst(ArrayDeque.kt:145)                                                  |                                                                                                                          |
|                                                                                                                          |             size(): 2 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                            |                                                                                                                          |
|                                                                                                                          |               getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                          |
|                                                                                                                          |                 size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                          |
|                                                                                                                          |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                      |                                                                                                                          |
|                                                                                                                          |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                      |                                                                                                                          |
|                                                                                                                          |           READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                           |                                                                                                                          |
|                                                                                                                          |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                      |                                                                                                                          |
|                                                                                                                          |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                      |                                                                                                                          |
|                                                                                                                          |           WRITE(null) at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                       |                                                                                                                          |
|                                                                                                                          |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                      |                                                                                                                          |
|                                                                                                                          |           incremented(0): 1 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                 |                                                                                                                          |
|                                                                                                                          |             elementData.READ: Object[]@2 at ArrayDeque.incremented(ArrayDeque.kt:94)                                     |                                                                                                                          |
|                                                                                                                          |           head.WRITE(1) at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                     |                                                                                                                          |
|                                                                                                                          |           size(): 2 at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                         |                                                                                                                          |
|                                                                                                                          |             getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |
|                                                                                                                          |               size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |
|                                                                                                                          |           size.WRITE(1) at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                     |                                                                                                                          |
|                                                                                                                          |       set(2,Result@3) at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                          |                                                                                                                          |
|                                                                                                                          |     unlock() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:345)                                                |                                                                                                                          |
|                                                                                                                          |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(SpinlockEventsCutTests.kt:307)                  |                                                                                                                          |
|                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)           |                                                                                                                          |
|                                                                                                                          |     get(2): Result@3 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)                                        |                                                                                                                          |
|                                                                                                                          | dequeue()                                                                                                                |                                                                                                                          |
|                                                                                                                          |   dequeue(): 1 at FaaQueueSpinLockTest.dequeue(SpinlockEventsCutTests.kt:264)                                            |                                                                                                                          |
|                                                                                                                          |     randomCellIndex(): 1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:331)                                    |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |
|                                                                                                                          |       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |
|                                                                                                                          |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |
|                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)           |                                                                                                                          |
|                                                                                                                          |     compareAndSet(1,null,Dequeue@1): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)                   |                                                                                                                          |
|                                                                                                                          |     tryLock(): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:337)                                         |                                                                                                                          |
|                                                                                                                          |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(SpinlockEventsCutTests.kt:306)                 |                                                                                                                          |
|                                                                                                                          |     help() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:344)                                                  |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(0): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                             |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(1): Dequeue@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                        |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)            |                                                                                                                          |
|                                                                                                                          |       removeFirstOrNull(): 1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                   |                                                                                                                          |
|                                                                                                                          |         isEmpty(): false at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                              |                                                                                                                          |
|                                                                                                                          |           size(): 1 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                              |                                                                                                                          |
|                                                                                                                          |             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |
|                                                                                                                          |               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |
|                                                                                                                          |         removeFirst(): 1 at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                              |                                                                                                                          |
|                                                                                                                          |           isEmpty(): false at ArrayDeque.removeFirst(ArrayDeque.kt:145)                                                  |                                                                                                                          |
|                                                                                                                          |             size(): 1 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                            |                                                                                                                          |
|                                                                                                                          |               getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                          |
|                                                                                                                          |                 size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                          |
|                                                                                                                          |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                      |                                                                                                                          |
|                                                                                                                          |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                      |                                                                                                                          |
|                                                                                                                          |           READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                           |                                                                                                                          |
|                                                                                                                          |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                      |                                                                                                                          |
|                                                                                                                          |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                      |                                                                                                                          |
|                                                                                                                          |           WRITE(null) at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                       |                                                                                                                          |
|                                                                                                                          |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                      |                                                                                                                          |
|                                                                                                                          |           incremented(1): 2 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                 |                                                                                                                          |
|                                                                                                                          |             elementData.READ: Object[]@2 at ArrayDeque.incremented(ArrayDeque.kt:94)                                     |                                                                                                                          |
|                                                                                                                          |           head.WRITE(2) at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                     |                                                                                                                          |
|                                                                                                                          |           size(): 1 at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                         |                                                                                                                          |
|                                                                                                                          |             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |                                                                                                                          |
|                                                                                                                          |               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |                                                                                                                          |
|                                                                                                                          |           size.WRITE(0) at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                     |                                                                                                                          |
|                                                                                                                          |       set(1,Result@4) at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                          |                                                                                                                          |
|                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |                                                                                                                          |
|                                                                                                                          |       get(2): Result@3 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                         |                                                                                                                          |
|                                                                                                                          |     unlock() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:345)                                                |                                                                                                                          |
|                                                                                                                          |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(SpinlockEventsCutTests.kt:307)                  |                                                                                                                          |
|                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)           |                                                                                                                          |
|                                                                                                                          |     get(1): Result@4 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)                                        |                                                                                                                          |
|                                                                                                                          |                                                                                                                          | dequeue()                                                                                                                |
|                                                                                                                          |                                                                                                                          |   dequeue(): null at FaaQueueSpinLockTest.dequeue(SpinlockEventsCutTests.kt:264)                                         |
|                                                                                                                          |                                                                                                                          |     randomCellIndex(): 0 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:331)                                    |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |
|                                                                                                                          |                                                                                                                          |       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |
|                                                                                                                          |                                                                                                                          |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |
|                                                                                                                          |                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)           |
|                                                                                                                          |                                                                                                                          |     compareAndSet(0,null,Dequeue@1): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:333)                   |
|                                                                                                                          |                                                                                                                          |     tryLock(): true at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:337)                                         |
|                                                                                                                          |                                                                                                                          |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(SpinlockEventsCutTests.kt:306)                 |
|                                                                                                                          |                                                                                                                          |     help() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:344)                                                  |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |
|                                                                                                                          |                                                                                                                          |       get(0): Dequeue@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                        |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)            |
|                                                                                                                          |                                                                                                                          |       removeFirstOrNull(): null at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                |
|                                                                                                                          |                                                                                                                          |         isEmpty(): true at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                               |
|                                                                                                                          |                                                                                                                          |           size(): 0 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                              |
|                                                                                                                          |                                                                                                                          |             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                          |
|                                                                                                                          |                                                                                                                          |               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                       |
|                                                                                                                          |                                                                                                                          |       set(0,Result@5) at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:359)                                          |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |
|                                                                                                                          |                                                                                                                          |       get(1): Result@4 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                         |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)            |
|                                                                                                                          |                                                                                                                          |       get(2): Result@3 at FlatCombiningQueue.help(SpinlockEventsCutTests.kt:356)                                         |
|                                                                                                                          |                                                                                                                          |     unlock() at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:345)                                                |
|                                                                                                                          |                                                                                                                          |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(SpinlockEventsCutTests.kt:307)                  |
|                                                                                                                          |                                                                                                                          |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)           |
|                                                                                                                          |                                                                                                                          |     get(0): Result@5 at FlatCombiningQueue.dequeue(SpinlockEventsCutTests.kt:347)                                        |
|                                                                                                                          |                                                                                                                          | enqueue(1)                                                                                                               |
|                                                                                                                          |                                                                                                                          |   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                              |
|                                                                                                                          |                                                                                                                          |     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                                    |
|                                                                                                                          |                                                                                                                          |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |
|                                                                                                                          |                                                                                                                          |       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |
|                                                                                                                          |                                                                                                                          |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |
|                                                                                                                          |                                                                                                                          |     /* The following events repeat infinitely: */                                                                        |
|                                                                                                                          |                                                                                                                          | ┌╶> tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)           |
|                                                                                                                          |                                                                                                                          | |   compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                          |
|                                                                                                                          |                                                                                                                          | |   randomCellIndex(): 2 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:313)                                    |
|                                                                                                                          |                                                                                                                          | |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |
|                                                                                                                          |                                                                                                                          | |     length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |
|                                                                                                                          |                                                                                                                          | |     random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |
|                                                                                                                          |                                                                                                                          | └╶╶╶/* The next call would cause infinite spin-cycle, switch to avoid it */                                              |
|                                                                                                                          |                                                                                                                          |     switch (reason: active lock detected)                                                                                |
| enqueue(1)                                                                                                               |                                                                                                                          |                                                                                                                          |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(SpinlockEventsCutTests.kt:261)                                              |                                                                                                                          |                                                                                                                          |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:310)                                    |                                                                                                                          |                                                                                                                          |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |                                                                                                                          |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |                                                                                                                          |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |                                                                                                                          |
|     /* The following events repeat infinitely: */                                                                        |                                                                                                                          |                                                                                                                          |
| ┌╶> tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)           |                                                                                                                          |                                                                                                                          |
| |   compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:312)                          |                                                                                                                          |                                                                                                                          |
| |   randomCellIndex(): 1 at FlatCombiningQueue.enqueue(SpinlockEventsCutTests.kt:313)                                    |                                                                                                                          |                                                                                                                          |
| |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368) |                                                                                                                          |                                                                                                                          |
| |     length(): 3 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                                   |                                                                                                                          |                                                                                                                          |
| |     random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(SpinlockEventsCutTests.kt:368)                         |                                                                                                                          |                                                                                                                          |
| └╶╶╶/* The next call would cause infinite spin-cycle, switch to avoid it */                                              |                                                                                                                          |                                                                                                                          |
|     switch (reason: active lock detected)                                                                                |                                                                                                                          |                                                                                                                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
All unfinished threads are in deadlock
