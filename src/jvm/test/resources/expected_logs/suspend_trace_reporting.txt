= Invalid execution results =
Parallel part:
| bar(): -1 | foo(): SUSPENDED + void |

= The following interleaving leads to the error =
Parallel part trace:
| bar()                                                                                                 |                                                                                                              |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:36)            |                                                                                                              |
|   lock(null): Unit@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:68)                |                                                                                                              |
|   switch                                                                                              |                                                                                                              |
|                                                                                                       | foo()                                                                                                        |
|                                                                                                       |   barStarted.READ: true at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)                    |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(true) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)       |
|                                                                                                       |   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:58)        |
|                                                                                                       |     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                                     |
|                                                                                                       |     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                                 |
|                                                                                                       |       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                            |
|                                                                                                       |       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)               |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                      |
|                                                                                                       |       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                            |
|                                                                                                       |       addLast(LockCont@1) at MutexImpl.lockSuspend(Mutex.kt:210)                                             |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                                      |
|                                                                                                       |       removeOnCancellation(<cont>,LockCont@1) at MutexImpl.lockSuspend(Mutex.kt:221)                         |
|                                                                                                       |       getResult(): CoroutineSingletons@1 at MutexImpl.lockSuspend(Mutex.kt:435)                              |
|                                                                                                       |         isReusable(): false at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:257)     |
|                                                                                                       |         trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:260)      |
|                                                                                                       |         parentHandle.READ: null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:270) |
|                                                                                                       |   switch (reason: coroutine is suspended)                                                                    |
|   counter.READ: 0 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                   |                                                                                                              |
|   counter.WRITE(1) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                  |                                                                                                              |
|   unlock(null) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:72)                      |                                                                                                              |
|   canEnterForbiddenBlock.READ: true at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:40) |                                                                                                              |
|   result: -1                                                                                          |                                                                                                              |
|   thread is finished                                                                                  |                                                                                                              |
|                                                                                                       |   counter.READ: 1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)                          |
|                                                                                                       |   counter.WRITE(2) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)                         |
|                                                                                                       |   unlock(null) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:62)                             |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(false) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)      |
|                                                                                                       |   result: SUSPENDED + void                                                                                   |
|                                                                                                       |   thread is finished                                                                                         |

Detailed parallel part trace:
| bar()                                                                                                                                                                            |                                                                                                                                                         |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:36)                                                                                       |                                                                                                                                                         |
|   lock(null): Unit@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:68)                                                                                           |                                                                                                                                                         |
|     tryLock(null): true at MutexImpl.lock(Mutex.kt:184)                                                                                                                          |                                                                                                                                                         |
|       _state.READ: Empty@2 at MutexImpl.tryLock(Mutex.kt:428)                                                                                                                    |                                                                                                                                                         |
|       _state.compareAndSet(Empty@2,Empty@1): true at MutexImpl.tryLock(Mutex.kt:170)                                                                                             |                                                                                                                                                         |
|   switch                                                                                                                                                                         |                                                                                                                                                         |
|                                                                                                                                                                                  | foo()                                                                                                                                                   |
|                                                                                                                                                                                  |   barStarted.READ: true at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)                                                               |
|                                                                                                                                                                                  |   canEnterForbiddenBlock.WRITE(true) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)                                                  |
|                                                                                                                                                                                  |   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:58)                                                   |
|                                                                                                                                                                                  |     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                                                                                |
|                                                                                                                                                                                  |       _state.READ: Empty@1 at MutexImpl.tryLock(Mutex.kt:428)                                                                                           |
|                                                                                                                                                                                  |     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                                                                            |
|                                                                                                                                                                                  |       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                                                                       |
|                                                                                                                                                                                  |       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)                                                          |
|                                                                                                                                                                                  |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                                                                 |
|                                                                                                                                                                                  |       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                                                                       |
|                                                                                                                                                                                  |       addLast(LockCont@1) at MutexImpl.lockSuspend(Mutex.kt:210)                                                                                        |
|                                                                                                                                                                                  |         getPrevNode(): LockedQueue@1 at LockFreeLinkedListNode.addLast(LockFreeLinkedList.kt:144)                                                       |
|                                                                                                                                                                                  |           correctPrev(null): LockedQueue@1 at LockFreeLinkedListNode.getPrevNode(LockFreeLinkedList.kt:114)                                             |
|                                                                                                                                                                                  |             _prev.READ: LockedQueue@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:573)                                                  |
|                                                                                                                                                                                  |             _next.READ: LockedQueue@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:577)                                                  |
|                                                                                                                                                                                  |         addNext(LockCont@1,LockedQueue@1): true at LockFreeLinkedListNode.addLast(LockFreeLinkedList.kt:144)                                            |
|                                                                                                                                                                                  |           _prev.lazySet(LockedQueue@1) at LockFreeLinkedListNode.addNext(LockFreeLinkedList.kt:215)                                                     |
|                                                                                                                                                                                  |           _next.lazySet(LockedQueue@1) at LockFreeLinkedListNode.addNext(LockFreeLinkedList.kt:216)                                                     |
|                                                                                                                                                                                  |           _next.compareAndSet(LockedQueue@1,LockCont@1): true at LockFreeLinkedListNode.addNext(LockFreeLinkedList.kt:217)                              |
|                                                                                                                                                                                  |           finishAdd(LockedQueue@1) at LockFreeLinkedListNode.addNext(LockFreeLinkedList.kt:219)                                                         |
|                                                                                                                                                                                  |             _prev.READ: LockedQueue@1 at LockFreeLinkedListNode.finishAdd(LockFreeLinkedList.kt:682)                                                    |
|                                                                                                                                                                                  |             getNext(): LockedQueue@1 at LockFreeLinkedListNode.finishAdd(LockFreeLinkedList.kt:547)                                                     |
|                                                                                                                                                                                  |               _next.READ: LockedQueue@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                    |
|                                                                                                                                                                                  |             _prev.compareAndSet(LockedQueue@1,LockCont@1): true at LockFreeLinkedListNode.finishAdd(LockFreeLinkedList.kt:548)                          |
|                                                                                                                                                                                  |             isRemoved(): false at LockFreeLinkedListNode.finishAdd(LockFreeLinkedList.kt:551)                                                           |
|                                                                                                                                                                                  |               getNext(): LockedQueue@1 at LockFreeLinkedListNode.isRemoved(LockFreeLinkedList.kt:95)                                                    |
|                                                                                                                                                                                  |                 _next.READ: LockedQueue@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                  |
|                                                                                                                                                                                  |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                                                                                 |
|                                                                                                                                                                                  |       removeOnCancellation(<cont>,LockCont@1) at MutexImpl.lockSuspend(Mutex.kt:221)                                                                    |
|                                                                                                                                                                                  |         invokeOnCancellation(RemoveOnCancel@1) at CancellableContinuationKt.removeOnCancellation(CancellableContinuation.kt:366)                        |
|                                                                                                                                                                                  |           _state.READ: Active@1 at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:630)                                 |
|                                                                                                                                                                                  |           _state.compareAndSet(Active@1,RemoveOnCancel@1): true at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:338) |
|                                                                                                                                                                                  |       getResult(): CoroutineSingletons@1 at MutexImpl.lockSuspend(Mutex.kt:435)                                                                         |
|                                                                                                                                                                                  |         isReusable(): false at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:257)                                                |
|                                                                                                                                                                                  |           resumeMode.READ: 1 at CancellableContinuationImpl.isReusable(CancellableContinuationImpl.kt:110)                                              |
|                                                                                                                                                                                  |         trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:260)                                                 |
|                                                                                                                                                                                  |           _decision.READ: 0 at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:621)                                               |
|                                                                                                                                                                                  |           _decision.compareAndSet(0,1): true at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:238)                              |
|                                                                                                                                                                                  |         parentHandle.READ: null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:270)                                            |
|                                                                                                                                                                                  |   switch (reason: coroutine is suspended)                                                                                                               |
|   counter.READ: 0 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                                                                                              |                                                                                                                                                         |
|   counter.WRITE(1) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                                                                                             |                                                                                                                                                         |
|   unlock(null) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:72)                                                                                                 |                                                                                                                                                         |
|     _state.READ: LockedQueue@1 at MutexImpl.unlock(Mutex.kt:438)                                                                                                                 |                                                                                                                                                         |
|     removeFirstOrNull(): LockCont@1 at MutexImpl.unlock(Mutex.kt:335)                                                                                                            |                                                                                                                                                         |
|       getNext(): LockCont@1 at LockFreeLinkedListNode.removeFirstOrNull(LockFreeLinkedList.kt:286)                                                                               |                                                                                                                                                         |
|         _next.READ: LockCont@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                                                      |                                                                                                                                                         |
|       remove(): true at LockFreeLinkedListNode.removeFirstOrNull(LockFreeLinkedList.kt:288)                                                                                      |                                                                                                                                                         |
|         removeOrNext(): null at LockFreeLinkedListNode.remove(LockFreeLinkedList.kt:245)                                                                                         |                                                                                                                                                         |
|           getNext(): LockedQueue@1 at LockFreeLinkedListNode.removeOrNext(LockFreeLinkedList.kt:251)                                                                             |                                                                                                                                                         |
|             _next.READ: LockedQueue@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                                               |                                                                                                                                                         |
|           removed(): Removed@1 at LockFreeLinkedListNode.removeOrNext(LockFreeLinkedList.kt:254)                                                                                 |                                                                                                                                                         |
|             _removedRef.READ: null at LockFreeLinkedListNode.removed(LockFreeLinkedList.kt:71)                                                                                   |                                                                                                                                                         |
|             _removedRef.lazySet(Removed@1) at LockFreeLinkedListNode.removed(LockFreeLinkedList.kt:71)                                                                           |                                                                                                                                                         |
|           _next.compareAndSet(LockedQueue@1,Removed@1): true at LockFreeLinkedListNode.removeOrNext(LockFreeLinkedList.kt:255)                                                   |                                                                                                                                                         |
|           correctPrev(null): LockedQueue@1 at LockFreeLinkedListNode.removeOrNext(LockFreeLinkedList.kt:257)                                                                     |                                                                                                                                                         |
|             _prev.READ: LockCont@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:573)                                                                              |                                                                                                                                                         |
|             _next.READ: Removed@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:577)                                                                               |                                                                                                                                                         |
|             _prev.READ: LockedQueue@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:607)                                                                           |                                                                                                                                                         |
|             _next.READ: LockCont@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:577)                                                                              |                                                                                                                                                         |
|             _next.READ: Removed@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:577)                                                                               |                                                                                                                                                         |
|             _next.compareAndSet(LockCont@1,LockedQueue@1): true at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:601)                                                 |                                                                                                                                                         |
|             _next.READ: LockedQueue@1 at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:577)                                                                           |                                                                                                                                                         |
|             _prev.compareAndSet(LockCont@1,LockedQueue@1): true at LockFreeLinkedListNode.correctPrev(LockFreeLinkedList.kt:583)                                                 |                                                                                                                                                         |
|     tryResumeLockWaiter(): true at MutexImpl.unlock(Mutex.kt:340)                                                                                                                |                                                                                                                                                         |
|       take(): true at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:385)                                                                                                       |                                                                                                                                                         |
|         isTaken.compareAndSet(0,1): true at MutexImpl$LockWaiter.take(Mutex.kt:373)                                                                                              |                                                                                                                                                         |
|       tryResume(Unit@1,null,@1): <RESUME_TOKEN> at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:386)                                                                          |                                                                                                                                                         |
|         tryResumeImpl(Unit@1,null,@1): <RESUME_TOKEN> at CancellableContinuationImpl.tryResume(CancellableContinuationImpl.kt:505)                                               |                                                                                                                                                         |
|           _state.READ: RemoveOnCancel@1 at CancellableContinuationImpl.tryResumeImpl(CancellableContinuationImpl.kt:634)                                                         |                                                                                                                                                         |
|           resumeMode.READ: 1 at CancellableContinuationImpl.tryResumeImpl(CancellableContinuationImpl.kt:463)                                                                    |                                                                                                                                                         |
|           _state.compareAndSet(RemoveOnCancel@1,CompletedContinuation@1): true at CancellableContinuationImpl.tryResumeImpl(CancellableContinuationImpl.kt:464)                  |                                                                                                                                                         |
|           detachChildIfNonResuable() at CancellableContinuationImpl.tryResumeImpl(CancellableContinuationImpl.kt:465)                                                            |                                                                                                                                                         |
|             isReusable(): false at CancellableContinuationImpl.detachChildIfNonResuable(CancellableContinuationImpl.kt:488)                                                      |                                                                                                                                                         |
|               resumeMode.READ: 1 at CancellableContinuationImpl.isReusable(CancellableContinuationImpl.kt:110)                                                                   |                                                                                                                                                         |
|             detachChild$kotlinx_coroutines_core() at CancellableContinuationImpl.detachChildIfNonResuable(CancellableContinuationImpl.kt:488)                                    |                                                                                                                                                         |
|               parentHandle.READ: null at CancellableContinuationImpl.detachChild$kotlinx_coroutines_core(CancellableContinuationImpl.kt:495)                                     |                                                                                                                                                         |
|     owner.WRITE(<LOCKED>) at MutexImpl.unlock(Mutex.kt:341)                                                                                                                      |                                                                                                                                                         |
|     completeResumeLockWaiter() at MutexImpl.unlock(Mutex.kt:342)                                                                                                                 |                                                                                                                                                         |
|       completeResume(<RESUME_TOKEN>) at MutexImpl$LockCont.completeResumeLockWaiter(Mutex.kt:392)                                                                                |                                                                                                                                                         |
|         resumeMode.READ: 1 at CancellableContinuationImpl.completeResume(CancellableContinuationImpl.kt:513)                                                                     |                                                                                                                                                         |
|         dispatchResume(1) at CancellableContinuationImpl.completeResume(CancellableContinuationImpl.kt:513)                                                                      |                                                                                                                                                         |
|           tryResume(): false at CancellableContinuationImpl.dispatchResume(CancellableContinuationImpl.kt:395)                                                                   |                                                                                                                                                         |
|             _decision.READ: 1 at CancellableContinuationImpl.tryResume(CancellableContinuationImpl.kt:623)                                                                       |                                                                                                                                                         |
|           dispatch(<cont>,1) at CancellableContinuationImpl.dispatchResume(CancellableContinuationImpl.kt:397)                                                                   |                                                                                                                                                         |
|             resume(<cont>,<cont>,false) at DispatchedTaskKt.dispatch(DispatchedTask.kt:166)                                                                                      |                                                                                                                                                         |
|               takeState$kotlinx_coroutines_core(): CompletedContinuation@1 at DispatchedTaskKt.resume(DispatchedTask.kt:173)                                                     |                                                                                                                                                         |
|                 getState$kotlinx_coroutines_core(): CompletedContinuation@1 at CancellableContinuationImpl.takeState$kotlinx_coroutines_core(CancellableContinuationImpl.kt:137) |                                                                                                                                                         |
|                   _state.READ: CompletedContinuation@1 at CancellableContinuationImpl.getState$kotlinx_coroutines_core(CancellableContinuationImpl.kt:77)                        |                                                                                                                                                         |
|   canEnterForbiddenBlock.READ: true at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:40)                                                                            |                                                                                                                                                         |
|   result: -1                                                                                                                                                                     |                                                                                                                                                         |
|   thread is finished                                                                                                                                                             |                                                                                                                                                         |
|                                                                                                                                                                                  |   counter.READ: 1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)                                                                     |
|                                                                                                                                                                                  |   counter.WRITE(2) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)                                                                    |
|                                                                                                                                                                                  |   unlock(null) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:62)                                                                        |
|                                                                                                                                                                                  |     _state.READ: LockedQueue@1 at MutexImpl.unlock(Mutex.kt:438)                                                                                        |
|                                                                                                                                                                                  |     removeFirstOrNull(): null at MutexImpl.unlock(Mutex.kt:335)                                                                                         |
|                                                                                                                                                                                  |       getNext(): LockedQueue@1 at LockFreeLinkedListNode.removeFirstOrNull(LockFreeLinkedList.kt:286)                                                   |
|                                                                                                                                                                                  |         _next.READ: LockedQueue@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                          |
|                                                                                                                                                                                  |     _state.compareAndSet(LockedQueue@1,UnlockOp@1): true at MutexImpl.unlock(Mutex.kt:338)                                                              |
|                                                                                                                                                                                  |     perform(MutexImpl@1): null at MutexImpl.unlock(Mutex.kt:338)                                                                                        |
|                                                                                                                                                                                  |       _consensus.READ: <NO_DECISION> at AtomicOp.perform(Atomic.kt:94)                                                                                  |
|                                                                                                                                                                                  |       prepare(MutexImpl@1): null at AtomicOp.perform(Atomic.kt:96)                                                                                      |
|                                                                                                                                                                                  |         prepare(MutexImpl@1): null at MutexImpl$UnlockOp.prepare(Mutex.kt:412)                                                                          |
|                                                                                                                                                                                  |           isEmpty(): true at MutexImpl$UnlockOp.prepare(Mutex.kt:416)                                                                                   |
|                                                                                                                                                                                  |             getNext(): LockedQueue@1 at LockFreeLinkedListHead.isEmpty(LockFreeLinkedList.kt:639)                                                       |
|                                                                                                                                                                                  |               _next.READ: LockedQueue@1 at LockFreeLinkedListNode.getNext(LockFreeLinkedList.kt:674)                                                    |
|                                                                                                                                                                                  |       decide(null): null at AtomicOp.perform(Atomic.kt:96)                                                                                              |
|                                                                                                                                                                                  |         _consensus.READ: <NO_DECISION> at AtomicOp.decide(Atomic.kt:80)                                                                                 |
|                                                                                                                                                                                  |         _consensus.compareAndSet(<NO_DECISION>,null): true at AtomicOp.decide(Atomic.kt:82)                                                             |
|                                                                                                                                                                                  |       complete(MutexImpl@1,null) at AtomicOp.perform(Atomic.kt:99)                                                                                      |
|                                                                                                                                                                                  |         complete(MutexImpl@1,null) at MutexImpl$UnlockOp.complete(Mutex.kt:412)                                                                         |
|                                                                                                                                                                                  |           _state.compareAndSet(UnlockOp@1,Empty@2): true at MutexImpl$UnlockOp.complete(Mutex.kt:420)                                                   |
|                                                                                                                                                                                  |   canEnterForbiddenBlock.WRITE(false) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)                                                 |
|                                                                                                                                                                                  |   result: SUSPENDED + void                                                                                                                              |
|                                                                                                                                                                                  |   thread is finished                                                                                                                                    |