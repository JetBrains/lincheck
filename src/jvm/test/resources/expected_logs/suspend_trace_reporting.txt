= Invalid execution results =
| ---------------------------------- |
|       Thread 1       |  Thread 2   |
| ---------------------------------- |
| bar(): SUSPENDED + 0 | foo(): void |
| ---------------------------------- |

The following interleaving leads to the error:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                               Thread 1                                                |                                                Thread 2                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                                                       | foo()                                                                                                   |
|                                                                                                       |   barStarted.READ: false at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)              |
|                                                                                                       |   lock(null): Unit@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:74)                  |
|                                                                                                       |   counter.READ: 0 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)                     |
|                                                                                                       |   counter.WRITE(1) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)                    |
|                                                                                                       |   unlock(null) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:78)                        |
|                                                                                                       |     _state.READ: Empty@1 at MutexImpl.unlock(Mutex.kt:438)                                              |
|                                                                                                       |     switch                                                                                              |
| bar(): SUSPENDED + 0                                                                                  |                                                                                                         |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)            |                                                                                                         |
|   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:84) |                                                                                                         |
|     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                              |                                                                                                         |
|     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                          |                                                                                                         |
|       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                     |                                                                                                         |
|       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)        |                                                                                                         |
|       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                               |                                                                                                         |
|       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                     |                                                                                                         |
|       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                               |                                                                                                         |
|   switch (reason: coroutine is suspended)                                                             |                                                                                                         |
|   result: SUSPENDED + 0                                                                               |                                                                                                         |
|                                                                                                       |     _state.compareAndSet(Empty@1,Empty@2): false at MutexImpl.unlock(Mutex.kt:329)                      |
|                                                                                                       |     _state.READ: LockedQueue@1 at MutexImpl.unlock(Mutex.kt:438)                                        |
|                                                                                                       |     tryResumeLockWaiter(): true at MutexImpl.unlock(Mutex.kt:340)                                       |
|                                                                                                       |     owner.WRITE(<LOCKED>) at MutexImpl.unlock(Mutex.kt:341)                                             |
|                                                                                                       |     completeResumeLockWaiter() at MutexImpl.unlock(Mutex.kt:342)                                        |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(false) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:33) |
|                                                                                                       |   INSTANCE.READ: Unit@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:34)               |
|                                                                                                       |   result: void                                                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Detailed trace:
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                               Thread 1                                                |                                                                Thread 2                                                                |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                                                       | foo()                                                                                                                                  |
|                                                                                                       |   barStarted.READ: false at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:29)                                             |
|                                                                                                       |   lock(null): Unit@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:74)                                                 |
|                                                                                                       |     tryLock(null): true at MutexImpl.lock(Mutex.kt:184)                                                                                |
|                                                                                                       |       _state.READ: Empty@2 at MutexImpl.tryLock(Mutex.kt:428)                                                                          |
|                                                                                                       |       _state.compareAndSet(Empty@2,Empty@1): true at MutexImpl.tryLock(Mutex.kt:170)                                                   |
|                                                                                                       |     INSTANCE.READ: Unit@1 at MutexImpl.lock(Mutex.kt:184)                                                                              |
|                                                                                                       |   counter.READ: 0 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)                                                    |
|                                                                                                       |   counter.WRITE(1) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:31)                                                   |
|                                                                                                       |   unlock(null) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:78)                                                       |
|                                                                                                       |     _state.READ: Empty@1 at MutexImpl.unlock(Mutex.kt:438)                                                                             |
|                                                                                                       |     switch                                                                                                                             |
| bar(): SUSPENDED + 0                                                                                  |                                                                                                                                        |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)            |                                                                                                                                        |
|   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:84) |                                                                                                                                        |
|     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                              |                                                                                                                                        |
|       _state.READ: Empty@1 at MutexImpl.tryLock(Mutex.kt:428)                                         |                                                                                                                                        |
|     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                          |                                                                                                                                        |
|       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                     |                                                                                                                                        |
|       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)        |                                                                                                                                        |
|       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                               |                                                                                                                                        |
|       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                     |                                                                                                                                        |
|       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                               |                                                                                                                                        |
|   switch (reason: coroutine is suspended)                                                             |                                                                                                                                        |
|   result: SUSPENDED + 0                                                                               |                                                                                                                                        |
|                                                                                                       |     _state.compareAndSet(Empty@1,Empty@2): false at MutexImpl.unlock(Mutex.kt:329)                                                     |
|                                                                                                       |     _state.READ: LockedQueue@1 at MutexImpl.unlock(Mutex.kt:438)                                                                       |
|                                                                                                       |     tryResumeLockWaiter(): true at MutexImpl.unlock(Mutex.kt:340)                                                                      |
|                                                                                                       |       take(): true at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:385)                                                             |
|                                                                                                       |         isTaken.compareAndSet(0,1): true at MutexImpl$LockWaiter.take(Mutex.kt:373)                                                    |
|                                                                                                       |       INSTANCE.READ: Unit@1 at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:386)                                                    |
|                                                                                                       |       tryResume(Unit@1,null,@1): <RESUME_TOKEN> at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:386)                                |
|                                                                                                       |         getJob(): JobImpl@1 at JobNode.dispose(JobSupport.kt:1358)                                                                     |
|                                                                                                       |           job.READ: JobImpl@1 at JobNode.getJob(JobSupport.kt:1355)                                                                    |
|                                                                                                       |         removeNode$kotlinx_coroutines_core(ChildContinuation@1) at JobNode.dispose(JobSupport.kt:1358)                                 |
|                                                                                                       |           getState$kotlinx_coroutines_core(): ChildContinuation@1 at JobSupport.removeNode$kotlinx_coroutines_core(JobSupport.kt:1577) |
|                                                                                                       |             _state.READ: ChildContinuation@1 at JobSupport.getState$kotlinx_coroutines_core(JobSupport.kt:1482)                        |
|                                                                                                       |           _state.compareAndSet(ChildContinuation@1,Empty@1): true at JobSupport.removeNode$kotlinx_coroutines_core(JobSupport.kt:595)  |
|                                                                                                       |     owner.WRITE(<LOCKED>) at MutexImpl.unlock(Mutex.kt:341)                                                                            |
|                                                                                                       |     completeResumeLockWaiter() at MutexImpl.unlock(Mutex.kt:342)                                                                       |
|                                                                                                       |       completeResume(<RESUME_TOKEN>) at MutexImpl$LockCont.completeResumeLockWaiter(Mutex.kt:392)                                      |
|                                                                                                       |         size.READ: 2 at ArrayList.get(ArrayList.java:427)                                                                              |
|                                                                                                       |         elementData(0): AtomicReferenceArray@1 at ArrayList.get(ArrayList.java:428)                                                    |
|                                                                                                       |           elementData.READ: Object[]@1 at ArrayList.elementData(ArrayList.java:411)                                                    |
|                                                                                                       |           Array[0].READ: AtomicReferenceArray@1 at ArrayList.elementData(ArrayList.java:411)                                           |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(false) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:33)                                |
|                                                                                                       |   INSTANCE.READ: Unit@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:34)                                              |
|                                                                                                       |   result: void                                                                                                                         |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
