= Invalid execution results =
| ---------------------------------------- |
|    Thread 1     |        Thread 2        |
| ---------------------------------------- |
| trigger(): void | operation(): Suspended |
| ---------------------------------------- |

The following interleaving leads to the error:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                       Thread 1                                       |                                                                                          Thread 2                                                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| trigger()                                                                            |                                                                                                                                                                                            |
|   allowed.WRITE(true) at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:31)  |                                                                                                                                                                                            |
|   switch                                                                             |                                                                                                                                                                                            |
|                                                                                      | operation(): Suspended                                                                                                                                                                     |
|                                                                                      |   allowed.READ: true at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:37)                                                                                                       |
|                                                                                      |   neverWakeUpChannel.receive(<cont>): COROUTINE_SUSPENDED at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:38)                                                                  |
|                                                                                      |     BufferedChannel.receive$suspendImpl(BufferedChannel#1,<cont>): COROUTINE_SUSPENDED at BufferedChannel.receive(BufferedChannel.kt:0)                                                    |
|                                                                                      |       receiveSegment.get(): ChannelSegment#1 at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3519)                                                                               |
|                                                                                      |       SuspendedNotAwokeTest#1.neverWakeUpChannel.isClosedForReceive(): false at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3523)                                               |
|                                                                                      |       receivers.getAndIncrement(): 0 at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3526)                                                                                       |
|                                                                                      |       BufferedChannel.access$updateCellReceive(BufferedChannel#1,ChannelSegment#1,0,0,null): <SUSPEND_NO_WAITER> at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3541)           |
|                                                                                      |       SuspendedNotAwokeTest#1.neverWakeUpChannel.receiveOnNoWaiterSuspend(ChannelSegment#1,0,0,<cont>): COROUTINE_SUSPENDED at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:685) |
|                                                                                      |         BufferedChannel.access$updateCellReceive(BufferedChannel#1,ChannelSegment#1,0,0,<cont>): <SUSPEND> at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3575)            |
|                                                                                      |         BufferedChannel.access$prepareReceiverForSuspension(BufferedChannel#1,<cont>,ChannelSegment#1,0) at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3578)              |
|                                                                                      |         <cont>.getResult(): COROUTINE_SUSPENDED at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3648)                                                                       |
|                                                                                      |           trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:300)                                                                                  |
|                                                                                      |           getParentHandle(): null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:310)                                                                             |
|                                                                                      |           installParentHandle(): ChildContinuation#1 at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:311)                                                          |
|                                                                                      |   switch (reason: coroutine is suspended)                                                                                                                                                  |
|                                                                                      |   result: Suspended                                                                                                                                                                        |
|   allowed.WRITE(false) at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:32) |                                                                                                                                                                                            |
|   result: void                                                                       |                                                                                                                                                                                            |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Detailed trace:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                       Thread 1                                       |                                                                                          Thread 2                                                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| trigger()                                                                            |                                                                                                                                                                                            |
|   allowed.WRITE(true) at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:31)  |                                                                                                                                                                                            |
|   switch                                                                             |                                                                                                                                                                                            |
|                                                                                      | operation(): Suspended                                                                                                                                                                     |
|                                                                                      |   allowed.READ: true at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:37)                                                                                                       |
|                                                                                      |   neverWakeUpChannel.receive(<cont>): COROUTINE_SUSPENDED at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:38)                                                                  |
|                                                                                      |     BufferedChannel.receive$suspendImpl(BufferedChannel#1,<cont>): COROUTINE_SUSPENDED at BufferedChannel.receive(BufferedChannel.kt:0)                                                    |
|                                                                                      |       receiveSegment.get(): ChannelSegment#1 at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3519)                                                                               |
|                                                                                      |       SuspendedNotAwokeTest#1.neverWakeUpChannel.isClosedForReceive(): false at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3523)                                               |
|                                                                                      |         sendersAndCloseStatus.get(): 0 at BufferedChannel.isClosedForReceive(BufferedChannel.kt:2188)                                                                                      |
|                                                                                      |       receivers.getAndIncrement(): 0 at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3526)                                                                                       |
|                                                                                      |       BufferedChannel.access$updateCellReceive(BufferedChannel#1,ChannelSegment#1,0,0,null): <SUSPEND_NO_WAITER> at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:3541)           |
|                                                                                      |         SuspendedNotAwokeTest#1.neverWakeUpChannel.updateCellReceive(ChannelSegment#1,0,0,null): <SUSPEND_NO_WAITER> at BufferedChannel.access$updateCellReceive(BufferedChannel.kt:36)    |
|                                                                                      |           ChannelSegment#1.getState$kotlinx_coroutines_core(0): null at BufferedChannel.updateCellReceive(BufferedChannel.kt:999)                                                          |
|                                                                                      |             data[1].get(): null at ChannelSegment.getState$kotlinx_coroutines_core(BufferedChannel.kt:2773)                                                                                |
|                                                                                      |           sendersAndCloseStatus.get(): 0 at BufferedChannel.updateCellReceive(BufferedChannel.kt:1007)                                                                                     |
|                                                                                      |       SuspendedNotAwokeTest#1.neverWakeUpChannel.receiveOnNoWaiterSuspend(ChannelSegment#1,0,0,<cont>): COROUTINE_SUSPENDED at BufferedChannel.receive$suspendImpl(BufferedChannel.kt:685) |
|                                                                                      |         BufferedChannel.access$updateCellReceive(BufferedChannel#1,ChannelSegment#1,0,0,<cont>): <SUSPEND> at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3575)            |
|                                                                                      |           SuspendedNotAwokeTest#1.neverWakeUpChannel.updateCellReceive(ChannelSegment#1,0,0,<cont>): <SUSPEND> at BufferedChannel.access$updateCellReceive(BufferedChannel.kt:36)          |
|                                                                                      |             ChannelSegment#1.getState$kotlinx_coroutines_core(0): null at BufferedChannel.updateCellReceive(BufferedChannel.kt:999)                                                        |
|                                                                                      |               data[1].get(): null at ChannelSegment.getState$kotlinx_coroutines_core(BufferedChannel.kt:2773)                                                                              |
|                                                                                      |             sendersAndCloseStatus.get(): 0 at BufferedChannel.updateCellReceive(BufferedChannel.kt:1007)                                                                                   |
|                                                                                      |             ChannelSegment#1.casState$kotlinx_coroutines_core(0,null,<cont>): true at BufferedChannel.updateCellReceive(BufferedChannel.kt:1016)                                           |
|                                                                                      |               data[1].compareAndSet(null,<cont>): true at ChannelSegment.casState$kotlinx_coroutines_core(BufferedChannel.kt:2779)                                                         |
|                                                                                      |             expandBuffer() at BufferedChannel.updateCellReceive(BufferedChannel.kt:1019)                                                                                                   |
|                                                                                      |               isRendezvousOrUnlimited(): true at BufferedChannel.expandBuffer(BufferedChannel.kt:1173)                                                                                     |
|                                                                                      |                 getBufferEndCounter(): 0 at BufferedChannel.isRendezvousOrUnlimited(BufferedChannel.kt:90)                                                                                 |
|                                                                                      |                   bufferEnd.get(): 0 at BufferedChannel.getBufferEndCounter(BufferedChannel.kt:72)                                                                                         |
|                                                                                      |         BufferedChannel.access$prepareReceiverForSuspension(BufferedChannel#1,<cont>,ChannelSegment#1,0) at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3578)              |
|                                                                                      |           SuspendedNotAwokeTest#1.neverWakeUpChannel.prepareReceiverForSuspension(<cont>,ChannelSegment#1,0) at BufferedChannel.access$prepareReceiverForSuspension(BufferedChannel.kt:36) |
|                                                                                      |             <cont>.invokeOnCancellation(ChannelSegment#1,0) at BufferedChannel.prepareReceiverForSuspension(BufferedChannel.kt:717)                                                        |
|                                                                                      |               _decisionAndIndex.get(): 536870911 at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:0)                                                     |
|                                                                                      |               _decisionAndIndex.compareAndSet(536870911,0): true at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:392)                                   |
|                                                                                      |               invokeOnCancellationImpl(ChannelSegment#1) at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:394)                                           |
|                                                                                      |                 _state.get(): Active#1 at CancellableContinuationImpl.invokeOnCancellationImpl(CancellableContinuationImpl.kt:403)                                                         |
|                                                                                      |                 _state.compareAndSet(Active#1,ChannelSegment#1): true at CancellableContinuationImpl.invokeOnCancellationImpl(CancellableContinuationImpl.kt:407)                          |
|                                                                                      |         <cont>.getResult(): COROUTINE_SUSPENDED at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3648)                                                                       |
|                                                                                      |           trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:300)                                                                                  |
|                                                                                      |             _decisionAndIndex.get(): 0 at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:0)                                                                         |
|                                                                                      |             _decisionAndIndex.compareAndSet(0,536870912): true at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:278)                                               |
|                                                                                      |           getParentHandle(): null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:310)                                                                             |
|                                                                                      |             _parentHandle.get(): null at CancellableContinuationImpl.getParentHandle(CancellableContinuationImpl.kt:106)                                                                   |
|                                                                                      |           installParentHandle(): ChildContinuation#1 at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:311)                                                          |
|                                                                                      |             _parentHandle.compareAndSet(null,ChildContinuation#1): true at CancellableContinuationImpl.installParentHandle(CancellableContinuationImpl.kt:352)                             |
|                                                                                      |   switch (reason: coroutine is suspended)                                                                                                                                                  |
|                                                                                      |   result: Suspended                                                                                                                                                                        |
|   allowed.WRITE(false) at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:32) |                                                                                                                                                                                            |
|   result: void                                                                       |                                                                                                                                                                                            |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
