= Invalid execution results =
| ---------------------------------------- |
|    Thread 1     |        Thread 2        |
| ---------------------------------------- |
| trigger(): void | operation(): Suspended |
| ---------------------------------------- |

The following interleaving leads to the error:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                    Thread 1                                     |                                                                            Thread 2                                                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| trigger()                                                                       |                                                                                                                                                                 |
|   allowed = true at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:32)  |                                                                                                                                                                 |
|   switch                                                                        |                                                                                                                                                                 |
|                                                                                 | operation(): Suspended                                                                                                                                          |
|                                                                                 |   allowed ➜ true at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:38)                                                                                |
|                                                                                 |   neverWakeUpChannel.receive() [suspendable: Continuation#1]: COROUTINE_SUSPENDED at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:39)               |
|                                                                                 |     receiveSegment.get(): ChannelSegment#1 at BufferedChannel.receive(BufferedChannel.kt:0)                                                                     |
|                                                                                 |     $this.isClosedForReceive(): false at BufferedChannel.receive(BufferedChannel.kt:0)                                                                          |
|                                                                                 |     receivers.getAndIncrement(): 0 at BufferedChannel.receive(BufferedChannel.kt:0)                                                                             |
|                                                                                 |     BufferedChannel.updateCellReceive(ChannelSegment#1, 0, 0, null): <SUSPEND_NO_WAITER> at BufferedChannel.receive(BufferedChannel.kt:0)                       |
|                                                                                 |     $this.receiveOnNoWaiterSuspend(ChannelSegment#1, 0, 0, Continuation#1): COROUTINE_SUSPENDED at BufferedChannel.receive(BufferedChannel.kt:0)                |
|                                                                                 |       BufferedChannel.updateCellReceive(ChannelSegment#1, 0, 0, Continuation#2): <SUSPEND> at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3575) |
|                                                                                 |       BufferedChannel.prepareReceiverForSuspension(Continuation#2, ChannelSegment#1, 0) at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3578)    |
|                                                                                 |       cancellable$iv.getResult(): COROUTINE_SUSPENDED at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3648)                                      |
|                                                                                 |         isReusable(): false at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:297)                                                        |
|                                                                                 |         trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:300)                                                         |
|                                                                                 |         getParentHandle(): null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:310)                                                    |
|                                                                                 |         installParentHandle(): ChildContinuation#1 at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:311)                                 |
|                                                                                 |         switch (reason: coroutine is suspended)                                                                                                                 |
|                                                                                 |   result: Suspended                                                                                                                                             |
|   allowed = false at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:33) |                                                                                                                                                                 |
|   result: void                                                                  |                                                                                                                                                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Detailed trace:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                    Thread 1                                     |                                                                            Thread 2                                                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| trigger()                                                                       |                                                                                                                                                                 |
|   allowed = true at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:32)  |                                                                                                                                                                 |
|   switch                                                                        |                                                                                                                                                                 |
|                                                                                 | operation(): Suspended                                                                                                                                          |
|                                                                                 |   allowed ➜ true at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:38)                                                                                |
|                                                                                 |   neverWakeUpChannel.receive() [suspendable: Continuation#1]: COROUTINE_SUSPENDED at SuspendedNotAwokeTest.operation(SuspendedNotAwokeTest.kt:39)               |
|                                                                                 |     receiveSegment.get(): ChannelSegment#1 at BufferedChannel.receive(BufferedChannel.kt:0)                                                                     |
|                                                                                 |     $this.isClosedForReceive(): false at BufferedChannel.receive(BufferedChannel.kt:0)                                                                          |
|                                                                                 |       sendersAndCloseStatus.get(): 0 at BufferedChannel.isClosedForReceive(BufferedChannel.kt:2188)                                                             |
|                                                                                 |     receivers.getAndIncrement(): 0 at BufferedChannel.receive(BufferedChannel.kt:0)                                                                             |
|                                                                                 |     BufferedChannel.updateCellReceive(ChannelSegment#1, 0, 0, null): <SUSPEND_NO_WAITER> at BufferedChannel.receive(BufferedChannel.kt:0)                       |
|                                                                                 |       segment.getState(0): null at BufferedChannel.updateCellReceive(BufferedChannel.kt:999)                                                                    |
|                                                                                 |         data[1].get(): null at ChannelSegment.getState(BufferedChannel.kt:2773)                                                                                 |
|                                                                                 |       sendersAndCloseStatus.get(): 0 at BufferedChannel.updateCellReceive(BufferedChannel.kt:1007)                                                              |
|                                                                                 |     $this.receiveOnNoWaiterSuspend(ChannelSegment#1, 0, 0, Continuation#1): COROUTINE_SUSPENDED at BufferedChannel.receive(BufferedChannel.kt:0)                |
|                                                                                 |       BufferedChannel.updateCellReceive(ChannelSegment#1, 0, 0, Continuation#2): <SUSPEND> at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3575) |
|                                                                                 |         segment.getState(0): null at BufferedChannel.updateCellReceive(BufferedChannel.kt:999)                                                                  |
|                                                                                 |           data[1].get(): null at ChannelSegment.getState(BufferedChannel.kt:2773)                                                                               |
|                                                                                 |         sendersAndCloseStatus.get(): 0 at BufferedChannel.updateCellReceive(BufferedChannel.kt:1007)                                                            |
|                                                                                 |         segment.casState(0, null, Continuation#2): true at BufferedChannel.updateCellReceive(BufferedChannel.kt:1016)                                           |
|                                                                                 |           data[1].compareAndSet(null, Continuation#2): true at ChannelSegment.casState(BufferedChannel.kt:2779)                                                 |
|                                                                                 |         expandBuffer() at BufferedChannel.updateCellReceive(BufferedChannel.kt:1019)                                                                            |
|                                                                                 |           isRendezvousOrUnlimited(): true at BufferedChannel.expandBuffer(BufferedChannel.kt:1173)                                                              |
|                                                                                 |             getBufferEndCounter(): 0 at BufferedChannel.isRendezvousOrUnlimited(BufferedChannel.kt:90)                                                          |
|                                                                                 |               bufferEnd.get(): 0 at BufferedChannel.getBufferEndCounter(BufferedChannel.kt:72)                                                                  |
|                                                                                 |       BufferedChannel.prepareReceiverForSuspension(Continuation#2, ChannelSegment#1, 0) at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3578)    |
|                                                                                 |         $this$prepareReceiverForSuspension.invokeOnCancellation(ChannelSegment#1, 0) at BufferedChannel.prepareReceiverForSuspension(BufferedChannel.kt:717)    |
|                                                                                 |           _decisionAndIndex.get(): 536870911 at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:0)                              |
|                                                                                 |           _decisionAndIndex.compareAndSet(536870911, 0): true at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:392)           |
|                                                                                 |           invokeOnCancellationImpl(ChannelSegment#1) at CancellableContinuationImpl.invokeOnCancellation(CancellableContinuationImpl.kt:394)                    |
|                                                                                 |             _state.get(): Active#1 at CancellableContinuationImpl.invokeOnCancellationImpl(CancellableContinuationImpl.kt:403)                                  |
|                                                                                 |             _state.compareAndSet(Active#1, ChannelSegment#1): true at CancellableContinuationImpl.invokeOnCancellationImpl(CancellableContinuationImpl.kt:407)  |
|                                                                                 |       cancellable$iv.getResult(): COROUTINE_SUSPENDED at BufferedChannel.receiveOnNoWaiterSuspend(BufferedChannel.kt:3648)                                      |
|                                                                                 |         isReusable(): false at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:297)                                                        |
|                                                                                 |           resumeMode ➜ 1 at CancellableContinuationImpl.isReusable(CancellableContinuationImpl.kt:141)                                                          |
|                                                                                 |         trySuspend(): true at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:300)                                                         |
|                                                                                 |           _decisionAndIndex.get(): 0 at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:0)                                                |
|                                                                                 |           _decisionAndIndex.compareAndSet(0, 536870912): true at CancellableContinuationImpl.trySuspend(CancellableContinuationImpl.kt:278)                     |
|                                                                                 |         getParentHandle(): null at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:310)                                                    |
|                                                                                 |           _parentHandle.get(): null at CancellableContinuationImpl.getParentHandle(CancellableContinuationImpl.kt:106)                                          |
|                                                                                 |         installParentHandle(): ChildContinuation#1 at CancellableContinuationImpl.getResult(CancellableContinuationImpl.kt:311)                                 |
|                                                                                 |           _parentHandle.compareAndSet(null, ChildContinuation#1): true at CancellableContinuationImpl.installParentHandle(CancellableContinuationImpl.kt:352)   |
|                                                                                 |         switch (reason: coroutine is suspended)                                                                                                                 |
|                                                                                 |   result: Suspended                                                                                                                                             |
|   allowed = false at SuspendedNotAwokeTest.trigger(SuspendedNotAwokeTest.kt:33) |                                                                                                                                                                 |
|   result: void                                                                  |                                                                                                                                                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
