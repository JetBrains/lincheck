= The execution has hung, see the thread dump =
| ----------------------------------- |
|  Thread 1  | Thread 2  |  Thread 3  |
| ----------------------------------- |
| enqueue(1) |           |            |
| enqueue(1) |           |            |
| ----------------------------------- |
| enqueue(1) | dequeue() | dequeue()  |
| dequeue()  | dequeue() | enqueue(1) |
| ----------------------------------- |
| enqueue(1) |           |            |
| dequeue()  |           |            |
| ----------------------------------- |


The following interleaving leads to the error:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                  Thread 1                                                   | Thread 2  |                                                  Thread 3                                                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| enqueue(1)                                                                                                  |           |                                                                                                             |
| enqueue(1)                                                                                                  |           |                                                                                                             |
|                                                                                                             | dequeue() |                                                                                                             |
|                                                                                                             | dequeue() |                                                                                                             |
|                                                                                                             |           | dequeue()                                                                                                   |
|                                                                                                             |           | enqueue(1)                                                                                                  |
|                                                                                                             |           |   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                    |
|                                                                                                             |           |     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                          |
|                                                                                                             |           |     /* The following events repeat infinitely: */                                                           |
|                                                                                                             |           |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95) |
|                                                                                                             |           |     compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                |
|                                                                                                             |           |     randomCellIndex(): 2 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:96)                          |
|                                                                                                             |           |     switch (reason: active lock detected)                                                                   |
| enqueue(1)                                                                                                  |           |                                                                                                             |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                    |           |                                                                                                             |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                          |           |                                                                                                             |
|     /* The following events repeat infinitely: */                                                           |           |                                                                                                             |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95) |           |                                                                                                             |
|     compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                |           |                                                                                                             |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:96)                          |           |                                                                                                             |
|     switch (reason: active lock detected)                                                                   |           |                                                                                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock

Detailed trace:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                        Thread 1                                                        |                                                        Thread 2                                                        |                                                        Thread 3                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| enqueue(1)                                                                                                             |                                                                                                                        |                                                                                                                        |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                               |                                                                                                                        |                                                                                                                        |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                                     |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |                                                                                                                        |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |                                                                                                                        |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)            |                                                                                                                        |                                                                                                                        |
|     compareAndSet(1,null,1): true at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                            |                                                                                                                        |                                                                                                                        |
|     tryLock(): true at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:99)                                          |                                                                                                                        |                                                                                                                        |
|       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(FaaQueueSpinLockTest.kt:89)                  |                                                                                                                        |                                                                                                                        |
|     help() at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:106)                                                  |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(0): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(1): 1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                                |                                                                                                                        |                                                                                                                        |
|       add(1): true at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:144)                                             |                                                                                                                        |                                                                                                                        |
|         addLast(1) at ArrayDeque.add(ArrayDeque.kt:179)                                                                |                                                                                                                        |                                                                                                                        |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:135)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           ensureCapacity(1) at ArrayDeque.addLast(ArrayDeque.kt:135)                                                   |                                                                                                                        |                                                                                                                        |
|             elementData.READ: Object[]@1 at ArrayDeque.ensureCapacity(ArrayDeque.kt:60)                                |                                                                                                                        |                                                                                                                        |
|             elementData.READ: Object[]@1 at ArrayDeque.ensureCapacity(ArrayDeque.kt:61)                                |                                                                                                                        |                                                                                                                        |
|             elementData.WRITE(Object[]@2) at ArrayDeque.ensureCapacity(ArrayDeque.kt:62)                               |                                                                                                                        |                                                                                                                        |
|           elementData.READ: Object[]@2 at ArrayDeque.addLast(ArrayDeque.kt:137)                                        |                                                                                                                        |                                                                                                                        |
|           head.READ: 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                        |                                                                                                                        |                                                                                                                        |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           positiveMod(0): 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                   |                                                                                                                        |                                                                                                                        |
|             elementData.READ: Object[]@2 at ArrayDeque.positiveMod(ArrayDeque.kt:87)                                   |                                                                                                                        |                                                                                                                        |
|           WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:137)                                                            |                                                                                                                        |                                                                                                                        |
|           size(): 0 at ArrayDeque.addLast(ArrayDeque.kt:138)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           size.WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:138)                                                       |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:145)            |                                                                                                                        |                                                                                                                        |
|       set(1,Result@1) at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:145)                                          |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(2): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |                                                                                                                        |
|     unlock() at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:107)                                                |                                                                                                                        |                                                                                                                        |
|       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(FaaQueueSpinLockTest.kt:90)                   |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:108)           |                                                                                                                        |                                                                                                                        |
|     get(1): Result@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:108)                                        |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:109)           |                                                                                                                        |                                                                                                                        |
|     set(1,null) at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:109)                                             |                                                                                                                        |                                                                                                                        |
| enqueue(1)                                                                                                             |                                                                                                                        |                                                                                                                        |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                               |                                                                                                                        |                                                                                                                        |
|     randomCellIndex(): 0 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                                     |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |                                                                                                                        |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |                                                                                                                        |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)            |                                                                                                                        |                                                                                                                        |
|     compareAndSet(0,null,1): true at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                            |                                                                                                                        |                                                                                                                        |
|     tryLock(): true at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:99)                                          |                                                                                                                        |                                                                                                                        |
|       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(FaaQueueSpinLockTest.kt:89)                  |                                                                                                                        |                                                                                                                        |
|     help() at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:106)                                                  |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(0): 1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                                |                                                                                                                        |                                                                                                                        |
|       add(1): true at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:144)                                             |                                                                                                                        |                                                                                                                        |
|         addLast(1) at ArrayDeque.add(ArrayDeque.kt:179)                                                                |                                                                                                                        |                                                                                                                        |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:135)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           ensureCapacity(2) at ArrayDeque.addLast(ArrayDeque.kt:135)                                                   |                                                                                                                        |                                                                                                                        |
|             elementData.READ: Object[]@2 at ArrayDeque.ensureCapacity(ArrayDeque.kt:60)                                |                                                                                                                        |                                                                                                                        |
|           elementData.READ: Object[]@2 at ArrayDeque.addLast(ArrayDeque.kt:137)                                        |                                                                                                                        |                                                                                                                        |
|           head.READ: 0 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                        |                                                                                                                        |                                                                                                                        |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           positiveMod(1): 1 at ArrayDeque.addLast(ArrayDeque.kt:137)                                                   |                                                                                                                        |                                                                                                                        |
|             elementData.READ: Object[]@2 at ArrayDeque.positiveMod(ArrayDeque.kt:87)                                   |                                                                                                                        |                                                                                                                        |
|           WRITE(1) at ArrayDeque.addLast(ArrayDeque.kt:137)                                                            |                                                                                                                        |                                                                                                                        |
|           size(): 1 at ArrayDeque.addLast(ArrayDeque.kt:138)                                                           |                                                                                                                        |                                                                                                                        |
|             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |                                                                                                                        |
|               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |                                                                                                                        |
|           size.WRITE(2) at ArrayDeque.addLast(ArrayDeque.kt:138)                                                       |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:145)            |                                                                                                                        |                                                                                                                        |
|       set(0,Result@2) at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:145)                                          |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(1): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |                                                                                                                        |
|       get(2): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |                                                                                                                        |
|     unlock() at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:107)                                                |                                                                                                                        |                                                                                                                        |
|       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(FaaQueueSpinLockTest.kt:90)                   |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:108)           |                                                                                                                        |                                                                                                                        |
|     get(0): Result@2 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:108)                                        |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:109)           |                                                                                                                        |                                                                                                                        |
|     set(0,null) at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:109)                                             |                                                                                                                        |                                                                                                                        |
|                                                                                                                        | dequeue()                                                                                                              |                                                                                                                        |
|                                                                                                                        |   dequeue(): 1 at FaaQueueSpinLockTest.dequeue(FaaQueueSpinLockTest.kt:47)                                             |                                                                                                                        |
|                                                                                                                        |     randomCellIndex(): 2 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:114)                                    |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |
|                                                                                                                        |       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |
|                                                                                                                        |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |
|                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)           |                                                                                                                        |
|                                                                                                                        |     compareAndSet(2,null,Dequeue@1): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)                   |                                                                                                                        |
|                                                                                                                        |     tryLock(): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:120)                                         |                                                                                                                        |
|                                                                                                                        |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(FaaQueueSpinLockTest.kt:89)                  |                                                                                                                        |
|                                                                                                                        |     help() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:127)                                                  |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(0): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(1): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(2): Dequeue@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                        |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)            |                                                                                                                        |
|                                                                                                                        |       removeFirstOrNull(): 1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                   |                                                                                                                        |
|                                                                                                                        |         isEmpty(): false at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                            |                                                                                                                        |
|                                                                                                                        |           size(): 2 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                            |                                                                                                                        |
|                                                                                                                        |             getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |
|                                                                                                                        |               size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |
|                                                                                                                        |         removeFirst(): 1 at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                            |                                                                                                                        |
|                                                                                                                        |           isEmpty(): false at ArrayDeque.removeFirst(ArrayDeque.kt:145)                                                |                                                                                                                        |
|                                                                                                                        |             size(): 2 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                          |                                                                                                                        |
|                                                                                                                        |               getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                      |                                                                                                                        |
|                                                                                                                        |                 size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                   |                                                                                                                        |
|                                                                                                                        |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                    |                                                                                                                        |
|                                                                                                                        |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                    |                                                                                                                        |
|                                                                                                                        |           READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                         |                                                                                                                        |
|                                                                                                                        |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                    |                                                                                                                        |
|                                                                                                                        |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                    |                                                                                                                        |
|                                                                                                                        |           WRITE(null) at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                     |                                                                                                                        |
|                                                                                                                        |           head.READ: 0 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                    |                                                                                                                        |
|                                                                                                                        |           incremented(0): 1 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                               |                                                                                                                        |
|                                                                                                                        |             elementData.READ: Object[]@2 at ArrayDeque.incremented(ArrayDeque.kt:94)                                   |                                                                                                                        |
|                                                                                                                        |           head.WRITE(1) at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                   |                                                                                                                        |
|                                                                                                                        |           size(): 2 at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                       |                                                                                                                        |
|                                                                                                                        |             getSize(): 2 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |
|                                                                                                                        |               size.READ: 2 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |
|                                                                                                                        |           size.WRITE(1) at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                   |                                                                                                                        |
|                                                                                                                        |       set(2,Result@3) at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                          |                                                                                                                        |
|                                                                                                                        |     unlock() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:128)                                                |                                                                                                                        |
|                                                                                                                        |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(FaaQueueSpinLockTest.kt:90)                   |                                                                                                                        |
|                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)           |                                                                                                                        |
|                                                                                                                        |     get(2): Result@3 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)                                        |                                                                                                                        |
|                                                                                                                        | dequeue()                                                                                                              |                                                                                                                        |
|                                                                                                                        |   dequeue(): 1 at FaaQueueSpinLockTest.dequeue(FaaQueueSpinLockTest.kt:47)                                             |                                                                                                                        |
|                                                                                                                        |     randomCellIndex(): 1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:114)                                    |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |
|                                                                                                                        |       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |
|                                                                                                                        |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |
|                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)           |                                                                                                                        |
|                                                                                                                        |     compareAndSet(1,null,Dequeue@1): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)                   |                                                                                                                        |
|                                                                                                                        |     tryLock(): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:120)                                         |                                                                                                                        |
|                                                                                                                        |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(FaaQueueSpinLockTest.kt:89)                  |                                                                                                                        |
|                                                                                                                        |     help() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:127)                                                  |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(0): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                             |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(1): Dequeue@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                        |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)            |                                                                                                                        |
|                                                                                                                        |       removeFirstOrNull(): 1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                   |                                                                                                                        |
|                                                                                                                        |         isEmpty(): false at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                            |                                                                                                                        |
|                                                                                                                        |           size(): 1 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                            |                                                                                                                        |
|                                                                                                                        |             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |
|                                                                                                                        |               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |
|                                                                                                                        |         removeFirst(): 1 at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                            |                                                                                                                        |
|                                                                                                                        |           isEmpty(): false at ArrayDeque.removeFirst(ArrayDeque.kt:145)                                                |                                                                                                                        |
|                                                                                                                        |             size(): 1 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                          |                                                                                                                        |
|                                                                                                                        |               getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                      |                                                                                                                        |
|                                                                                                                        |                 size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                   |                                                                                                                        |
|                                                                                                                        |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                    |                                                                                                                        |
|                                                                                                                        |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                    |                                                                                                                        |
|                                                                                                                        |           READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:147)                                                         |                                                                                                                        |
|                                                                                                                        |           elementData.READ: Object[]@2 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                    |                                                                                                                        |
|                                                                                                                        |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                    |                                                                                                                        |
|                                                                                                                        |           WRITE(null) at ArrayDeque.removeFirst(ArrayDeque.kt:148)                                                     |                                                                                                                        |
|                                                                                                                        |           head.READ: 1 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                    |                                                                                                                        |
|                                                                                                                        |           incremented(1): 2 at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                               |                                                                                                                        |
|                                                                                                                        |             elementData.READ: Object[]@2 at ArrayDeque.incremented(ArrayDeque.kt:94)                                   |                                                                                                                        |
|                                                                                                                        |           head.WRITE(2) at ArrayDeque.removeFirst(ArrayDeque.kt:149)                                                   |                                                                                                                        |
|                                                                                                                        |           size(): 1 at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                       |                                                                                                                        |
|                                                                                                                        |             getSize(): 1 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |                                                                                                                        |
|                                                                                                                        |               size.READ: 1 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |                                                                                                                        |
|                                                                                                                        |           size.WRITE(0) at ArrayDeque.removeFirst(ArrayDeque.kt:150)                                                   |                                                                                                                        |
|                                                                                                                        |       set(1,Result@4) at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                          |                                                                                                                        |
|                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |                                                                                                                        |
|                                                                                                                        |       get(2): Result@3 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                         |                                                                                                                        |
|                                                                                                                        |     unlock() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:128)                                                |                                                                                                                        |
|                                                                                                                        |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(FaaQueueSpinLockTest.kt:90)                   |                                                                                                                        |
|                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)           |                                                                                                                        |
|                                                                                                                        |     get(1): Result@4 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)                                        |                                                                                                                        |
|                                                                                                                        |                                                                                                                        | dequeue()                                                                                                              |
|                                                                                                                        |                                                                                                                        |   dequeue(): null at FaaQueueSpinLockTest.dequeue(FaaQueueSpinLockTest.kt:47)                                          |
|                                                                                                                        |                                                                                                                        |     randomCellIndex(): 0 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:114)                                    |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |
|                                                                                                                        |                                                                                                                        |       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |
|                                                                                                                        |                                                                                                                        |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |
|                                                                                                                        |                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)           |
|                                                                                                                        |                                                                                                                        |     compareAndSet(0,null,Dequeue@1): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:116)                   |
|                                                                                                                        |                                                                                                                        |     tryLock(): true at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:120)                                         |
|                                                                                                                        |                                                                                                                        |       combinerLock.compareAndSet(0,1): true at FlatCombiningQueue.tryLock(FaaQueueSpinLockTest.kt:89)                  |
|                                                                                                                        |                                                                                                                        |     help() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:127)                                                  |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |
|                                                                                                                        |                                                                                                                        |       get(0): Dequeue@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                        |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)            |
|                                                                                                                        |                                                                                                                        |       removeFirstOrNull(): null at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                |
|                                                                                                                        |                                                                                                                        |         isEmpty(): true at ArrayDeque.removeFirstOrNull(ArrayDeque.kt:157)                                             |
|                                                                                                                        |                                                                                                                        |           size(): 0 at ArrayDeque.isEmpty(ArrayDeque.kt:98)                                                            |
|                                                                                                                        |                                                                                                                        |             getSize(): 0 at AbstractMutableList.size(AbstractMutableList.kt:15)                                        |
|                                                                                                                        |                                                                                                                        |               size.READ: 0 at ArrayDeque.getSize(ArrayDeque.kt:22)                                                     |
|                                                                                                                        |                                                                                                                        |       set(0,Result@5) at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:142)                                          |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |
|                                                                                                                        |                                                                                                                        |       get(1): Result@4 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                         |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)            |
|                                                                                                                        |                                                                                                                        |       get(2): Result@3 at FlatCombiningQueue.help(FaaQueueSpinLockTest.kt:139)                                         |
|                                                                                                                        |                                                                                                                        |     unlock() at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:128)                                                |
|                                                                                                                        |                                                                                                                        |       combinerLock.compareAndSet(1,0): true at FlatCombiningQueue.unlock(FaaQueueSpinLockTest.kt:90)                   |
|                                                                                                                        |                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)           |
|                                                                                                                        |                                                                                                                        |     get(0): Result@5 at FlatCombiningQueue.dequeue(FaaQueueSpinLockTest.kt:130)                                        |
|                                                                                                                        |                                                                                                                        | enqueue(1)                                                                                                             |
|                                                                                                                        |                                                                                                                        |   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                               |
|                                                                                                                        |                                                                                                                        |     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                                     |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |
|                                                                                                                        |                                                                                                                        |       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |
|                                                                                                                        |                                                                                                                        |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |
|                                                                                                                        |                                                                                                                        |     /* The following events repeat infinitely: */                                                                      |
|                                                                                                                        |                                                                                                                        |     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)            |
|                                                                                                                        |                                                                                                                        |     compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                           |
|                                                                                                                        |                                                                                                                        |     randomCellIndex(): 2 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:96)                                     |
|                                                                                                                        |                                                                                                                        |       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |
|                                                                                                                        |                                                                                                                        |       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |
|                                                                                                                        |                                                                                                                        |       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |
|                                                                                                                        |                                                                                                                        |     switch (reason: active lock detected)                                                                              |
| enqueue(1)                                                                                                             |                                                                                                                        |                                                                                                                        |
|   enqueue(1) at FaaQueueSpinLockTest.enqueue(FaaQueueSpinLockTest.kt:44)                                               |                                                                                                                        |                                                                                                                        |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:93)                                     |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |                                                                                                                        |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |                                                                                                                        |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |                                                                                                                        |
|     /* The following events repeat infinitely: */                                                                      |                                                                                                                        |                                                                                                                        |
|     tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)            |                                                                                                                        |                                                                                                                        |
|     compareAndSet(1,null,1): false at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:95)                           |                                                                                                                        |                                                                                                                        |
|     randomCellIndex(): 1 at FlatCombiningQueue.enqueue(FaaQueueSpinLockTest.kt:96)                                     |                                                                                                                        |                                                                                                                        |
|       tasksForCombiner.READ: AtomicReferenceArray@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151) |                                                                                                                        |                                                                                                                        |
|       length(): 3 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                                   |                                                                                                                        |                                                                                                                        |
|       random.READ: Random@1 at FlatCombiningQueue.randomCellIndex(FaaQueueSpinLockTest.kt:151)                         |                                                                                                                        |                                                                                                                        |
|     switch (reason: active lock detected)                                                                              |                                                                                                                        |                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
All unfinished threads are in deadlock
