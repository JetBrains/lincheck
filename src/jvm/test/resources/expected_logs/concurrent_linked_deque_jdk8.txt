= Invalid execution results =
| ------------------------------------ |
|     Thread 1     |     Thread 2      |
| ------------------------------------ |
| addLast(1): void |                   |
| ------------------------------------ |
| pollFirst(): 1   | addFirst(0): void |
|                  | peekLast(): 1     |
| ------------------------------------ |

---
All operations above the horizontal line | ----- | happen before those below the line
---

The following interleaving leads to the error:
| ------------------------------------------------------------------------------------------------------------------ |
|                                              Thread 1                                              |   Thread 2    |
| ------------------------------------------------------------------------------------------------------------------ |
| addLast(1)                                                                                         |               |
| ------------------------------------------------------------------------------------------------------------------ |
| pollFirst(): 1                                                                                     |               |
|   deque.pollFirst(): 1 at ConcurrentLinkedDequeTest.pollFirst(ConcurrentLinkedDequeTest.kt:30)     |               |
|     first(): Node#1 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:965)             |               |
|     head.item ➜ null at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:966)            |               |
|     succ(Node#1): Node#2 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:965)        |               |
|     switch                                                                                         |               |
|                                                                                                    | addFirst(0)   |
|                                                                                                    | peekLast(): 1 |
|     Node#2.item ➜ 1 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:966)             |               |
|     tail.casItem(1, null): true at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:967) |               |
|     unlink(Node#2) at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:968)              |               |
|   result: 1                                                                                        |               |
| ------------------------------------------------------------------------------------------------------------------ |

Detailed trace:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                             Thread 1                                                              |                                                          Thread 2                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| addLast(1)                                                                                                                        |                                                                                                                             |
|   deque.addLast(1) at ConcurrentLinkedDequeTest.addLast(ConcurrentLinkedDequeTest.kt:27)                                          |                                                                                                                             |
|     linkLast(1) at ConcurrentLinkedDeque.addLast(ConcurrentLinkedDeque.java:903)                                                  |                                                                                                                             |
|       tail ➜ Node#1 at ConcurrentLinkedDeque.linkLast(ConcurrentLinkedDeque.java:391)                                             |                                                                                                                             |
|       head.next ➜ null at ConcurrentLinkedDeque.linkLast(ConcurrentLinkedDeque.java:392)                                          |                                                                                                                             |
|       head.prev ➜ null at ConcurrentLinkedDeque.linkLast(ConcurrentLinkedDeque.java:397)                                          |                                                                                                                             |
|       head.casNext(null, Node#2): true at ConcurrentLinkedDeque.linkLast(ConcurrentLinkedDeque.java:402)                          |                                                                                                                             |
|         next.compareAndSwapObject(null, Node#2): true at ConcurrentLinkedDeque$Node.casNext(ConcurrentLinkedDeque.java:315)       |                                                                                                                             |
|   result: void                                                                                                                    |                                                                                                                             |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| pollFirst(): 1                                                                                                                    |                                                                                                                             |
|   deque.pollFirst(): 1 at ConcurrentLinkedDequeTest.pollFirst(ConcurrentLinkedDequeTest.kt:30)                                    |                                                                                                                             |
|     first(): Node#1 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:965)                                            |                                                                                                                             |
|       head ➜ Node#1 at ConcurrentLinkedDeque.first(ConcurrentLinkedDeque.java:748)                                                |                                                                                                                             |
|       head.prev ➜ null at ConcurrentLinkedDeque.first(ConcurrentLinkedDeque.java:749)                                             |                                                                                                                             |
|     head.item ➜ null at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:966)                                           |                                                                                                                             |
|     succ(Node#1): Node#2 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:965)                                       |                                                                                                                             |
|       head.next ➜ Node#2 at ConcurrentLinkedDeque.succ(ConcurrentLinkedDeque.java:725)                                            |                                                                                                                             |
|     switch                                                                                                                        |                                                                                                                             |
|                                                                                                                                   | addFirst(0)                                                                                                                 |
|                                                                                                                                   |   deque.addFirst(0) at ConcurrentLinkedDequeTest.addFirst(ConcurrentLinkedDequeTest.kt:24)                                  |
|                                                                                                                                   |     linkFirst(0) at ConcurrentLinkedDeque.addFirst(ConcurrentLinkedDeque.java:890)                                          |
|                                                                                                                                   |       head ➜ Node#1 at ConcurrentLinkedDeque.linkFirst(ConcurrentLinkedDeque.java:358)                                      |
|                                                                                                                                   |       head.prev ➜ null at ConcurrentLinkedDeque.linkFirst(ConcurrentLinkedDeque.java:359)                                   |
|                                                                                                                                   |       head.next ➜ Node#2 at ConcurrentLinkedDeque.linkFirst(ConcurrentLinkedDeque.java:364)                                 |
|                                                                                                                                   |       head.casPrev(null, Node#3): true at ConcurrentLinkedDeque.linkFirst(ConcurrentLinkedDeque.java:369)                   |
|                                                                                                                                   |         prev.compareAndSwapObject(null, Node#3): true at ConcurrentLinkedDeque$Node.casPrev(ConcurrentLinkedDeque.java:323) |
|                                                                                                                                   |   result: void                                                                                                              |
|                                                                                                                                   | peekLast(): 1                                                                                                               |
|                                                                                                                                   |   deque.peekLast(): 1 at ConcurrentLinkedDequeTest.peekLast(ConcurrentLinkedDequeTest.kt:39)                                |
|                                                                                                                                   |     last(): Node#2 at ConcurrentLinkedDeque.peekLast(ConcurrentLinkedDeque.java:942)                                        |
|                                                                                                                                   |       tail ➜ Node#1 at ConcurrentLinkedDeque.last(ConcurrentLinkedDeque.java:773)                                           |
|                                                                                                                                   |       head.next ➜ Node#2 at ConcurrentLinkedDeque.last(ConcurrentLinkedDeque.java:774)                                      |
|                                                                                                                                   |       Node#2.next ➜ null at ConcurrentLinkedDeque.last(ConcurrentLinkedDeque.java:774)                                      |
|                                                                                                                                   |       casTail(Node#1, Node#2): true at ConcurrentLinkedDeque.last(ConcurrentLinkedDeque.java:782)                           |
|                                                                                                                                   |         tail.compareAndSwapObject(Node#1, Node#2): true at ConcurrentLinkedDeque.casTail(ConcurrentLinkedDeque.java:1562)   |
|                                                                                                                                   |     tail.item ➜ 1 at ConcurrentLinkedDeque.peekLast(ConcurrentLinkedDeque.java:943)                                         |
|                                                                                                                                   |   result: 1                                                                                                                 |
|     Node#2.item ➜ 1 at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:966)                                            |                                                                                                                             |
|     tail.casItem(1, null): true at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:967)                                |                                                                                                                             |
|       item.compareAndSwapObject(1, null): true at ConcurrentLinkedDeque$Node.casItem(ConcurrentLinkedDeque.java:307)              |                                                                                                                             |
|     unlink(Node#2) at ConcurrentLinkedDeque.pollFirst(ConcurrentLinkedDeque.java:968)                                             |                                                                                                                             |
|       tail.prev ➜ Node#1 at ConcurrentLinkedDeque.unlink(ConcurrentLinkedDeque.java:426)                                          |                                                                                                                             |
|       tail.next ➜ null at ConcurrentLinkedDeque.unlink(ConcurrentLinkedDeque.java:427)                                            |                                                                                                                             |
|       unlinkLast(Node#2, Node#1) at ConcurrentLinkedDeque.unlink(ConcurrentLinkedDeque.java:431)                                  |                                                                                                                             |
|         head.item ➜ null at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:570)                                      |                                                                                                                             |
|         head.prev ➜ Node#3 at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:570)                                    |                                                                                                                             |
|         Node#3.item ➜ 0 at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:570)                                       |                                                                                                                             |
|         Node#3.next ➜ Node#1 at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:571)                                  |                                                                                                                             |
|         tail.casPrev(Node#1, Node#3): true at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:571)                    |                                                                                                                             |
|           prev.compareAndSwapObject(Node#1, Node#3): true at ConcurrentLinkedDeque$Node.casPrev(ConcurrentLinkedDeque.java:323)   |                                                                                                                             |
|         skipDeletedSuccessors(Node#3) at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:572)                         |                                                                                                                             |
|           Node#3.next ➜ Node#1 at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:690)                     |                                                                                                                             |
|           head.item ➜ null at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:697)                         |                                                                                                                             |
|           head.next ➜ Node#2 at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:699)                       |                                                                                                                             |
|           tail.item ➜ null at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:697)                         |                                                                                                                             |
|           tail.next ➜ null at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:699)                         |                                                                                                                             |
|           tail.prev ➜ Node#3 at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:701)                       |                                                                                                                             |
|           Node#3.casNext(Node#1, Node#2): true at ConcurrentLinkedDeque.skipDeletedSuccessors(ConcurrentLinkedDeque.java:712)     |                                                                                                                             |
|             next.compareAndSwapObject(Node#1, Node#2): true at ConcurrentLinkedDeque$Node.casNext(ConcurrentLinkedDeque.java:315) |                                                                                                                             |
|         tail.next ➜ null at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:573)                                      |                                                                                                                             |
|         Node#3.prev ➜ null at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:573)                                    |                                                                                                                             |
|         Node#3.next ➜ Node#2 at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:573)                                  |                                                                                                                             |
|         updateHead() at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:577)                                          |                                                                                                                             |
|           head ➜ Node#1 at ConcurrentLinkedDeque.updateHead(ConcurrentLinkedDeque.java:607)                                       |                                                                                                                             |
|           head.item ➜ null at ConcurrentLinkedDeque.updateHead(ConcurrentLinkedDeque.java:607)                                    |                                                                                                                             |
|           head.prev ➜ Node#3 at ConcurrentLinkedDeque.updateHead(ConcurrentLinkedDeque.java:607)                                  |                                                                                                                             |
|           Node#3.prev ➜ null at ConcurrentLinkedDeque.updateHead(ConcurrentLinkedDeque.java:609)                                  |                                                                                                                             |
|           casHead(Node#1, Node#3): true at ConcurrentLinkedDeque.updateHead(ConcurrentLinkedDeque.java:613)                       |                                                                                                                             |
|             head.compareAndSwapObject(Node#1, Node#3): true at ConcurrentLinkedDeque.casHead(ConcurrentLinkedDeque.java:1558)     |                                                                                                                             |
|         updateTail() at ConcurrentLinkedDeque.unlinkLast(ConcurrentLinkedDeque.java:578)                                          |                                                                                                                             |
|           tail ➜ Node#2 at ConcurrentLinkedDeque.updateTail(ConcurrentLinkedDeque.java:637)                                       |                                                                                                                             |
|           tail.item ➜ null at ConcurrentLinkedDeque.updateTail(ConcurrentLinkedDeque.java:637)                                    |                                                                                                                             |
|           tail.next ➜ null at ConcurrentLinkedDeque.updateTail(ConcurrentLinkedDeque.java:637)                                    |                                                                                                                             |
|   result: 1                                                                                                                       |                                                                                                                             |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
