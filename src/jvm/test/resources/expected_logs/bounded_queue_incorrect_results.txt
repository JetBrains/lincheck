= The execution has hung, see the thread dump =
| ------------------------ |
|  Thread 1   |  Thread 2  |
| ------------------------ |
| enqueue(1)  |            |
| enqueue(0)  |            |
| ------------------------ |
| enqueue(1)  | enqueue(1) |
| enqueue(1)  |            |
| enqueue(1)  |            |
| enqueue(2)  |            |
| ------------------------ |
| enqueue(1)  |            |
| enqueue(-3) |            |
| enqueue(-2) |            |
| enqueue(1)  |            |
| ------------------------ |


The following interleaving leads to the error:
| -------------------------------------------------------------------------------------------------------- |
|                                          Thread 1                                           |  Thread 2  |
| -------------------------------------------------------------------------------------------------------- |
| enqueue(1)                                                                                  |            |
| enqueue(0)                                                                                  |            |
|                                                                                             | enqueue(1) |
| enqueue(1)                                                                                  |            |
| enqueue(1)                                                                                  |            |
| enqueue(1)                                                                                  |            |
| enqueue(2)                                                                                  |            |
| enqueue(1)                                                                                  |            |
| enqueue(-3)                                                                                 |            |
| enqueue(-2)                                                                                 |            |
| enqueue(1)                                                                                  |            |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |            |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |            |
|     enqueue(Marked@1) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |            |
|       /* The following events repeat infinitely: */                                         |            |
|       enqueuePos.READ: 10 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                   |            |
|       READ: Cell@1 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |            |
|       sequence.READ: 1 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |            |
|       switch (reason: active lock detected)                                                 |            |
| -------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock

Detailed trace:
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                          Thread 1                                           |                                          Thread 2                                           |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@2) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 0 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@1 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 0 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(0,1): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@2) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(1) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(0)                                                                                  |                                                                                             |
|   enqueue(0) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@3) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 1 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@2 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 1 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(1,2): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@3) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(2) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
|                                                                                             | enqueue(1)                                                                                  |
|                                                                                             |   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |
|                                                                                             |     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |
|                                                                                             |     enqueue(Marked@4) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |
|                                                                                             |       enqueuePos.READ: 2 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |
|                                                                                             |       READ: Cell@3 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |
|                                                                                             |       sequence.READ: 2 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |
|                                                                                             |       enqueuePos.compareAndSet(2,3): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |
|                                                                                             |       data.WRITE(Marked@4) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |
|                                                                                             |       sequence.WRITE(3) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |
|                                                                                             |     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@5) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 3 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@4 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 3 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(3,4): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@5) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(4) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@6) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 4 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@5 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 4 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(4,5): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@6) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(5) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@7) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 5 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@6 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 5 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(5,6): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@7) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(6) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(2)                                                                                  |                                                                                             |
|   enqueue(2) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@8) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 6 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@7 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 6 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(6,7): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@8) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(7) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@9) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       enqueuePos.READ: 7 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@8 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 7 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(7,8): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@9) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                  |                                                                                             |
|       sequence.WRITE(8) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(-3)                                                                                 |                                                                                             |
|   enqueue(-3) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                           |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@10) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                      |                                                                                             |
|       enqueuePos.READ: 8 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@9 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 8 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(8,9): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)   |                                                                                             |
|       data.WRITE(Marked@10) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                 |                                                                                             |
|       sequence.WRITE(9) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                     |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(-2)                                                                                 |                                                                                             |
|   enqueue(-2) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                           |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@11) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                      |                                                                                             |
|       enqueuePos.READ: 9 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                    |                                                                                             |
|       READ: Cell@10 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                         |                                                                                             |
|       sequence.READ: 9 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       enqueuePos.compareAndSet(9,10): true at BoundedQueue.enqueue(BoundedQueueTest.kt:93)  |                                                                                             |
|       data.WRITE(Marked@11) at BoundedQueue.enqueue(BoundedQueueTest.kt:94)                 |                                                                                             |
|       sequence.WRITE(10) at BoundedQueue.enqueue(BoundedQueueTest.kt:95)                    |                                                                                             |
|     concurrentEnqueues.getAndDecrement(): 1 at QueueAdaptor.enqueue(BoundedQueueTest.kt:57) |                                                                                             |
| enqueue(1)                                                                                  |                                                                                             |
|   enqueue(1) at BoundedQueueTest.enqueue(BoundedQueueTest.kt:30)                            |                                                                                             |
|     concurrentEnqueues.getAndIncrement(): 0 at QueueAdaptor.enqueue(BoundedQueueTest.kt:54) |                                                                                             |
|     enqueue(Marked@1) at QueueAdaptor.enqueue(BoundedQueueTest.kt:55)                       |                                                                                             |
|       /* The following events repeat infinitely: */                                         |                                                                                             |
|       enqueuePos.READ: 10 at BoundedQueue.enqueue(BoundedQueueTest.kt:87)                   |                                                                                             |
|       READ: Cell@1 at BoundedQueue.enqueue(BoundedQueueTest.kt:89)                          |                                                                                             |
|       sequence.READ: 1 at BoundedQueue.enqueue(BoundedQueueTest.kt:90)                      |                                                                                             |
|       switch (reason: active lock detected)                                                 |                                                                                             |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock
