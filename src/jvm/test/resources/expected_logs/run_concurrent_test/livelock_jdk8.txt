= Concurrent test has hung =

The following interleaving leads to the error:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                                    Main Thread                                                                     |                                                                                                  Thread 1                                                                                                   |                                                                                                  Thread 2                                                                                                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| $this_runCatching.block() at BaseRunConcurrentRepresentationTest.testRunWithModelChecker$lambda$1$lambda$0(RunConcurrentRepresentationTests.kt:47) |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|   block() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:318)                                                |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     Thread#1.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:342)                                     |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     Thread#2.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:342)                                     |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     switch (reason: waiting for Thread 1 to finish)                                                                                                |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|                                                                                                                                                    |                                                                                                                                                                                                             | run()                                                                                                                                                                                                       |
|                                                                                                                                                    |                                                                                                                                                                                                             |   SpinLockTestKt.withLock(SpinLock#1, block$t2$1$1#1) at LivelockRunConcurrentRepresentationTest.block$lambda$1(RunConcurrentRepresentationTests.kt:335)                                                    |
|                                                                                                                                                    |                                                                                                                                                                                                             |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                                    |
|                                                                                                                                                    |                                                                                                                                                                                                             |     switch                                                                                                                                                                                                  |
|                                                                                                                                                    | run()                                                                                                                                                                                                       |                                                                                                                                                                                                             |
|                                                                                                                                                    |   SpinLockTestKt.withLock(SpinLock#2, block$t1$1$1#1) at LivelockRunConcurrentRepresentationTest.block$lambda$0(RunConcurrentRepresentationTests.kt:328)                                                    |                                                                                                                                                                                                             |
|                                                                                                                                                    |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                                    |                                                                                                                                                                                                             |
|                                                                                                                                                    |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                                                                           |                                                                                                                                                                                                             |
|                                                                                                                                                    |       invoke() at LivelockRunConcurrentRepresentationTest$block$t1$1$1.invoke(RunConcurrentRepresentationTests.kt:328)                                                                                      |                                                                                                                                                                                                             |
|                                                                                                                                                    |         SpinLockTestKt.withLock(SpinLock#1, LivelockRunConcurrentRepresentationTest$block$t1$1$1$1) at LivelockRunConcurrentRepresentationTest$block$t1$1$1.invoke(RunConcurrentRepresentationTests.kt:329) |                                                                                                                                                                                                             |
|                                                                                                                                                    |           $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                              |                                                                                                                                                                                                             |
|                                                                                                                                                    |             /* The following events repeat infinitely: */                                                                                                                                                   |                                                                                                                                                                                                             |
|                                                                                                                                                    |         ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                     |                                                                                                                                                                                                             |
|                                                                                                                                                    |         └╶╶ switch (reason: active lock detected)                                                                                                                                                           |                                                                                                                                                                                                             |
|                                                                                                                                                    |                                                                                                                                                                                                             |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                                                                           |
|                                                                                                                                                    |                                                                                                                                                                                                             |       invoke() at LivelockRunConcurrentRepresentationTest$block$t2$1$1.invoke(RunConcurrentRepresentationTests.kt:335)                                                                                      |
|                                                                                                                                                    |                                                                                                                                                                                                             |         SpinLockTestKt.withLock(SpinLock#2, LivelockRunConcurrentRepresentationTest$block$t2$1$1$1) at LivelockRunConcurrentRepresentationTest$block$t2$1$1.invoke(RunConcurrentRepresentationTests.kt:336) |
|                                                                                                                                                    |                                                                                                                                                                                                             |           $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                              |
|                                                                                                                                                    |                                                                                                                                                                                                             |             /* The following events repeat infinitely: */                                                                                                                                                   |
|                                                                                                                                                    |                                                                                                                                                                                                             |         ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                     |
|                                                                                                                                                    |                                                                                                                                                                                                             |         └╶╶ switch (reason: active lock detected)                                                                                                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
All unfinished threads are in deadlock

Detailed trace:
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                                                                    Main Thread                                                                     |                                                                                                  Thread 1                                                                                                   |                                                                                                  Thread 2                                                                                                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| $this_runCatching.block() at BaseRunConcurrentRepresentationTest.testRunWithModelChecker$lambda$1$lambda$0(RunConcurrentRepresentationTests.kt:47) |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|   block() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:318)                                                |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     Thread#1.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:342)                                     |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     Thread#2.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:342)                                     |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|     switch (reason: waiting for Thread 1 to finish)                                                                                                |                                                                                                                                                                                                             |                                                                                                                                                                                                             |
|                                                                                                                                                    |                                                                                                                                                                                                             | run()                                                                                                                                                                                                       |
|                                                                                                                                                    |                                                                                                                                                                                                             |   SpinLockTestKt.withLock(SpinLock#1, block$t2$1$1#1) at LivelockRunConcurrentRepresentationTest.block$lambda$1(RunConcurrentRepresentationTests.kt:335)                                                    |
|                                                                                                                                                    |                                                                                                                                                                                                             |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                                    |
|                                                                                                                                                    |                                                                                                                                                                                                             |       lock.compareAndSet(false, true): true at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                            |
|                                                                                                                                                    |                                                                                                                                                                                                             |     switch                                                                                                                                                                                                  |
|                                                                                                                                                    | run()                                                                                                                                                                                                       |                                                                                                                                                                                                             |
|                                                                                                                                                    |   SpinLockTestKt.withLock(SpinLock#2, block$t1$1$1#1) at LivelockRunConcurrentRepresentationTest.block$lambda$0(RunConcurrentRepresentationTests.kt:328)                                                    |                                                                                                                                                                                                             |
|                                                                                                                                                    |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                                    |                                                                                                                                                                                                             |
|                                                                                                                                                    |       lock.compareAndSet(false, true): true at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                            |                                                                                                                                                                                                             |
|                                                                                                                                                    |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                                                                           |                                                                                                                                                                                                             |
|                                                                                                                                                    |       invoke() at LivelockRunConcurrentRepresentationTest$block$t1$1$1.invoke(RunConcurrentRepresentationTests.kt:328)                                                                                      |                                                                                                                                                                                                             |
|                                                                                                                                                    |         SpinLockTestKt.withLock(SpinLock#1, LivelockRunConcurrentRepresentationTest$block$t1$1$1$1) at LivelockRunConcurrentRepresentationTest$block$t1$1$1.invoke(RunConcurrentRepresentationTests.kt:329) |                                                                                                                                                                                                             |
|                                                                                                                                                    |           $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                              |                                                                                                                                                                                                             |
|                                                                                                                                                    |             /* The following events repeat infinitely: */                                                                                                                                                   |                                                                                                                                                                                                             |
|                                                                                                                                                    |         ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                     |                                                                                                                                                                                                             |
|                                                                                                                                                    |         └╶╶ switch (reason: active lock detected)                                                                                                                                                           |                                                                                                                                                                                                             |
|                                                                                                                                                    |                                                                                                                                                                                                             |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                                                                           |
|                                                                                                                                                    |                                                                                                                                                                                                             |       invoke() at LivelockRunConcurrentRepresentationTest$block$t2$1$1.invoke(RunConcurrentRepresentationTests.kt:335)                                                                                      |
|                                                                                                                                                    |                                                                                                                                                                                                             |         SpinLockTestKt.withLock(SpinLock#2, LivelockRunConcurrentRepresentationTest$block$t2$1$1$1) at LivelockRunConcurrentRepresentationTest$block$t2$1$1.invoke(RunConcurrentRepresentationTests.kt:336) |
|                                                                                                                                                    |                                                                                                                                                                                                             |           $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                                                              |
|                                                                                                                                                    |                                                                                                                                                                                                             |             /* The following events repeat infinitely: */                                                                                                                                                   |
|                                                                                                                                                    |                                                                                                                                                                                                             |         ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                                                                     |
|                                                                                                                                                    |                                                                                                                                                                                                             |         └╶╶ switch (reason: active lock detected)                                                                                                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
All unfinished threads are in deadlock
