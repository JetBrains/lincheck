= Concurrent test has hung =

The following interleaving leads to the error:
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                    Main Thread                                                                     |                                                                            Thread 1                                                                             |                                                                            Thread 2                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $this_runCatching.block() at BaseRunConcurrentRepresentationTest.testRunWithModelChecker$lambda$1$lambda$0(RunConcurrentRepresentationTests.kt:48) |                                                                                                                                                                 |                                                                                                                                                                 |
|   block() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:327)                                                |                                                                                                                                                                 |                                                                                                                                                                 |
|     CollectionsKt.listOf(Array<Thread>#1): ArrayList#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:350)   |                                                                                                                                                                 |                                                                                                                                                                 |
|     threads.forEach() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:351)                                    |                                                                                                                                                                 |                                                                                                                                                                 |
|     threads.forEach() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:352)                                    |                                                                                                                                                                 |                                                                                                                                                                 |
|       iterator(): ArrayItr#2 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                             |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#2.hasNext(): true at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                         |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#2.next(): Thread#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                        |                                                                                                                                                                 |                                                                                                                                                                 |
|       switch (reason: waiting for Thread 1 to finish)                                                                                              |                                                                                                                                                                 |                                                                                                                                                                 |
|                                                                                                                                                    |                                                                                                                                                                 | run()                                                                                                                                                           |
|                                                                                                                                                    |                                                                                                                                                                 |   SpinLockTestKt.withLock(SpinLock#2, Lambda#2) at LivelockRunConcurrentRepresentationTest.block$lambda$5(RunConcurrentRepresentationTests.kt:344)              |
|                                                                                                                                                    |                                                                                                                                                                 |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                        |
|                                                                                                                                                    |                                                                                                                                                                 |     switch                                                                                                                                                      |
|                                                                                                                                                    | run()                                                                                                                                                           |                                                                                                                                                                 |
|                                                                                                                                                    |   SpinLockTestKt.withLock(SpinLock#1, Lambda#4) at LivelockRunConcurrentRepresentationTest.block$lambda$2(RunConcurrentRepresentationTests.kt:337)              |                                                                                                                                                                 |
|                                                                                                                                                    |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                        |                                                                                                                                                                 |
|                                                                                                                                                    |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                               |                                                                                                                                                                 |
|                                                                                                                                                    |       SpinLockTestKt.withLock(SpinLock#2, Lambda#5) at LivelockRunConcurrentRepresentationTest.block$lambda$2$lambda$1(RunConcurrentRepresentationTests.kt:338) |                                                                                                                                                                 |
|                                                                                                                                                    |         $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                    |                                                                                                                                                                 |
|                                                                                                                                                    |           /* The following events repeat infinitely: */                                                                                                         |                                                                                                                                                                 |
|                                                                                                                                                    |       ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                           |                                                                                                                                                                 |
|                                                                                                                                                    |       |   Thread.yield() at SpinLock.lock(SpinLockTest.kt:84)                                                                                                   |                                                                                                                                                                 |
|                                                                                                                                                    |       └╶╶ switch (reason: active lock detected)                                                                                                                 |                                                                                                                                                                 |
|                                                                                                                                                    |                                                                                                                                                                 |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                               |
|                                                                                                                                                    |                                                                                                                                                                 |       SpinLockTestKt.withLock(SpinLock#1, Lambda#3) at LivelockRunConcurrentRepresentationTest.block$lambda$5$lambda$4(RunConcurrentRepresentationTests.kt:345) |
|                                                                                                                                                    |                                                                                                                                                                 |         $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                    |
|                                                                                                                                                    |                                                                                                                                                                 |           /* The following events repeat infinitely: */                                                                                                         |
|                                                                                                                                                    |                                                                                                                                                                 |       ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                           |
|                                                                                                                                                    |                                                                                                                                                                 |       |   Thread.yield() at SpinLock.lock(SpinLockTest.kt:84)                                                                                                   |
|                                                                                                                                                    |                                                                                                                                                                 |       └╶╶ switch (reason: active lock detected)                                                                                                                 |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock

Detailed trace:
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                                    Main Thread                                                                     |                                                                            Thread 1                                                                             |                                                                            Thread 2                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $this_runCatching.block() at BaseRunConcurrentRepresentationTest.testRunWithModelChecker$lambda$1$lambda$0(RunConcurrentRepresentationTests.kt:48) |                                                                                                                                                                 |                                                                                                                                                                 |
|   block() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:327)                                                |                                                                                                                                                                 |                                                                                                                                                                 |
|     CollectionsKt.listOf(Array<Thread>#1): ArrayList#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:350)   |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArraysKt.asList(Array<Thread>#1): ArrayList#1 at CollectionsKt__CollectionsKt.listOf(Collections.kt:78)                                      |                                                                                                                                                                 |                                                                                                                                                                 |
|         ArraysUtilJVM.asList(Array<Thread>#1): ArrayList#1 at ArraysKt___ArraysJvmKt.asList(_ArraysJvm.kt:133)                                     |                                                                                                                                                                 |                                                                                                                                                                 |
|           Arrays.asList(Array<Thread>#1): ArrayList#1 at ArraysUtilJVM.asList(ArraysUtilJVM.java:13)                                               |                                                                                                                                                                 |                                                                                                                                                                 |
|     threads.forEach() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:351)                                    |                                                                                                                                                                 |                                                                                                                                                                 |
|       iterator(): ArrayItr#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                             |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#1.hasNext(): true at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                         |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#1.next(): Thread#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                        |                                                                                                                                                                 |                                                                                                                                                                 |
|       Thread#1.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:351)                                   |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#1.hasNext(): true at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                         |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#1.next(): Thread#2 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                        |                                                                                                                                                                 |                                                                                                                                                                 |
|       Thread#2.start() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:351)                                   |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#1.hasNext(): false at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:485)                        |                                                                                                                                                                 |                                                                                                                                                                 |
|     threads.forEach() at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:352)                                    |                                                                                                                                                                 |                                                                                                                                                                 |
|       iterator(): ArrayItr#2 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                             |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#2.hasNext(): true at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                         |                                                                                                                                                                 |                                                                                                                                                                 |
|       ArrayItr#2.next(): Thread#1 at LivelockRunConcurrentRepresentationTest.block(RunConcurrentRepresentationTests.kt:487)                        |                                                                                                                                                                 |                                                                                                                                                                 |
|       switch (reason: waiting for Thread 1 to finish)                                                                                              |                                                                                                                                                                 |                                                                                                                                                                 |
|                                                                                                                                                    |                                                                                                                                                                 | run()                                                                                                                                                           |
|                                                                                                                                                    |                                                                                                                                                                 |   SpinLockTestKt.withLock(SpinLock#2, Lambda#2) at LivelockRunConcurrentRepresentationTest.block$lambda$5(RunConcurrentRepresentationTests.kt:344)              |
|                                                                                                                                                    |                                                                                                                                                                 |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                        |
|                                                                                                                                                    |                                                                                                                                                                 |       lock.compareAndSet(false, true): true at SpinLock.lock(SpinLockTest.kt:83)                                                                                |
|                                                                                                                                                    |                                                                                                                                                                 |     switch                                                                                                                                                      |
|                                                                                                                                                    | run()                                                                                                                                                           |                                                                                                                                                                 |
|                                                                                                                                                    |   SpinLockTestKt.withLock(SpinLock#1, Lambda#4) at LivelockRunConcurrentRepresentationTest.block$lambda$2(RunConcurrentRepresentationTests.kt:337)              |                                                                                                                                                                 |
|                                                                                                                                                    |     $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                        |                                                                                                                                                                 |
|                                                                                                                                                    |       lock.compareAndSet(false, true): true at SpinLock.lock(SpinLockTest.kt:83)                                                                                |                                                                                                                                                                 |
|                                                                                                                                                    |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                               |                                                                                                                                                                 |
|                                                                                                                                                    |       SpinLockTestKt.withLock(SpinLock#2, Lambda#5) at LivelockRunConcurrentRepresentationTest.block$lambda$2$lambda$1(RunConcurrentRepresentationTests.kt:338) |                                                                                                                                                                 |
|                                                                                                                                                    |         $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                    |                                                                                                                                                                 |
|                                                                                                                                                    |           /* The following events repeat infinitely: */                                                                                                         |                                                                                                                                                                 |
|                                                                                                                                                    |       ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                           |                                                                                                                                                                 |
|                                                                                                                                                    |       |   Thread.yield() at SpinLock.lock(SpinLockTest.kt:84)                                                                                                   |                                                                                                                                                                 |
|                                                                                                                                                    |       └╶╶ switch (reason: active lock detected)                                                                                                                 |                                                                                                                                                                 |
|                                                                                                                                                    |                                                                                                                                                                 |     block.invoke() at SpinLockTestKt.withLock(SpinLockTest.kt:96)                                                                                               |
|                                                                                                                                                    |                                                                                                                                                                 |       SpinLockTestKt.withLock(SpinLock#1, Lambda#3) at LivelockRunConcurrentRepresentationTest.block$lambda$5$lambda$4(RunConcurrentRepresentationTests.kt:345) |
|                                                                                                                                                    |                                                                                                                                                                 |         $this$withLock.lock() at SpinLockTestKt.withLock(SpinLockTest.kt:94)                                                                                    |
|                                                                                                                                                    |                                                                                                                                                                 |           /* The following events repeat infinitely: */                                                                                                         |
|                                                                                                                                                    |                                                                                                                                                                 |       ┌╶> lock.compareAndSet(false, true): false at SpinLock.lock(SpinLockTest.kt:83)                                                                           |
|                                                                                                                                                    |                                                                                                                                                                 |       |   Thread.yield() at SpinLock.lock(SpinLockTest.kt:84)                                                                                                   |
|                                                                                                                                                    |                                                                                                                                                                 |       └╶╶ switch (reason: active lock detected)                                                                                                                 |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
All unfinished threads are in deadlock
